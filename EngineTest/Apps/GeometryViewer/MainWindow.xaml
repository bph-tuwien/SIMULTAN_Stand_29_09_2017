<Window x:Class="GeometryViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:diag="clr-namespace:System.Diagnostics;assembly=WindowsBase"
        xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
        xmlns:sdx="clr-namespace:SharpDX;assembly=SharpDX"
        xmlns:htx="clr-namespace:HelixToolkit.SharpDX.Wpf;assembly=HelixToolkit.SharpDX.Wpf"
        xmlns:gvx="clr-namespace:GeometryViewer"
        xmlns:gvxht ="clr-namespace:GeometryViewer.HelixToolkitCustomization"
        xmlns:gvxc="clr-namespace:GeometryViewer.Communication"
        xmlns:gvxso="clr-namespace:GeometryViewer.SpatialOrganization"
        xmlns:gvxut="clr-namespace:GeometryViewer.Utils"
        xmlns:gvxuie="clr-namespace:GeometryViewer.UIElements"
        xmlns:gvxeg="clr-namespace:GeometryViewer.EntityGeometry"
        xmlns:gvxta="clr-namespace:GeometryViewer.TestAlgs"
        xmlns:gvxcr="clr-namespace:GeometryViewer.ComponentReps"
        mc:Ignorable="d"
        Title="GeometryViewer" Height="700" Width="1200">
    <Window.DataContext>
        <gvx:AppViewModel/>
    </Window.DataContext>
    <Window.InputBindings>
        <KeyBinding Key="O" Modifiers="Control" Command="{Binding OpenCmd}"/>
        <KeyBinding Key="Escape" Command="{Binding DeselectCmd, ElementName=lineGenerator, Mode=OneWay}" />
        <KeyBinding Key="Delete" Command="{Binding DeleteSelectedCmd, ElementName=lineGenerator, Mode=OneWay}"/>
        <KeyBinding Key="Z" Modifiers="Control" Command="{Binding ElementName=lineGenerator, Path=UndoManager.UndoOneStepCmd, Mode=OneWay}"/>
        <KeyBinding Key="R" Modifiers="Control" Command="{Binding ElementName=lineGenerator, Path=UndoManager.RedoOneStepCmd, Mode=OneWay}"/>
    </Window.InputBindings>
    <Window.Resources>
        <x:StaticExtension Member="htx:Techniques.RenderTechniques" x:Key="RenderTechniques"/>
        <!-- saves the data source in case it is not inherited by all-->
        <gvxut:BindingProxy x:Key="proxy" Data="{Binding}"/>
        <gvxut:InverseBooleanConverter x:Key="InvBoolConverter"/>
        <gvxut:DoubleToStringConverter x:Key="DoubleToStringConverter"/>
        <gvxut:DoubleStringToStringConverter x:Key="DoubleStringToStringConverter"/>
        <gvxut:IntToOrientationConverter x:Key="IntToOrientationConverter" />
        <gvxut:CloneConverter x:Key="CloneConverter" />
        <gvxut:BoolAndConverter x:Key="BoolAndConverter" />
        <gvxut:BooleanToVisibiltyConverter x:Key="BoolToVisConverter" />
        <gvxut:SharpDXColorToWinMediaColorConverter x:Key="SharpDXColorToWinMediaColorConverter"/>
        <gvxc:ActionToBooleanConverter x:Key="ActionToBooleanConverter"/>
        <gvxc:UserRoleToBooleanConverter x:Key="UserRoleToBooleanConverter"/>
        <gvxc:ZoneEditTypeToBooleanConverter x:Key="ZoneEditTypeToBooleanConverter"/>
        <gvxeg:PolygonEditModeTypeToBooleanConverter x:Key="PolygonEditModeTypeToBooleanConverter"/>
        <gvxeg:VolumeEditModeTypeToBooleanConverter x:Key="VolumeEditModeTypeToBooleanConverter" />
        <gvxeg:TreeViewSortingEntityConverter x:Key="TreeViewSortingEntityConverter" />
        <gvxcr:TreeViewSortingCompRepConverter x:Key="TreeViewSortingCompRepConverter"/>

        <gvx:PathEditingModeToBooleanConverter x:Key="PathEditingModeToBooleanConverter"/>

        <gvxut:DataTemplateSelectorSpace x:Key="DataTemplateSelectorSpace"/>
        <gvxut:DataTemplateSelectorPlacable x:Key="DataTemplateSelectorPlacable"/>
        
        <gvxut:ListOfStringsToStringConverter x:Key="ListOfStringsToStringConverter"/>
        <gvxut:TypeToBoolConverter x:Key="TypeToBoolConverter"/>

        <sys:Boolean x:Key="FalseValue">False</sys:Boolean>
        <sys:Boolean x:Key="TrueValue">True</sys:Boolean>

    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="49"/>
            <RowDefinition/>
            <RowDefinition Height="25"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition/>
            <ColumnDefinition Width="Auto" MinWidth="240" MaxWidth="600"/>
        </Grid.ColumnDefinitions>

        <!-- WINDOW MENU -->
        <Menu Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" VerticalAlignment="Top">
            <MenuItem Header="File">
                <!--<MenuItem Header="Import OBJ" InputGestureText="Ctrl+O" Command="{Binding OpenCmd}"/>-->
                <MenuItem Header="Import DXF" Command="{Binding ImportDXFCmd}" />
                <MenuItem Header="Open" InputGestureText="Ctrl+O" Command="{Binding ElementName=zoneGroupDisplay, Path=OpenGeometryFileCmd, Mode=OneWay}"/>
                <MenuItem Header="Save" InputGestureText="Ctrl+S" Command="{Binding ElementName=zoneGroupDisplay, Path=SaveGeometryCmd, Mode=OneWay}"/>
                <MenuItem Header="Export Selected to DXF" Command="{Binding ElementName=zoneGroupDisplay, Path=ExportSelectedToACADCmd, Mode=OneWay}" />
                <MenuItem Header="Export Visible to DXF" Command="{Binding ElementName=zoneGroupDisplay, Path=ExportAllToAutoCADCmd, Mode=OneWay}" />
                <MenuItem Header="Save Log Entries" Command="{Binding ElementName=MainView, Path=SaveLogEntriesCmd, Mode=OneWay}"/>
            </MenuItem>
            <MenuItem Header="Edit">
                <MenuItem Header="Undo" InputGestureText="Ctrl+Z" Command="{Binding ElementName=lineGenerator, Path=UndoManager.UndoOneStepCmd}"/>
                <MenuItem Header="Redo" InputGestureText="Ctrl+R" Command="{Binding ElementName=lineGenerator, Path=UndoManager.RedoOneStepCmd}"/>
            </MenuItem>
        </Menu>

        <!-- WINDOW DRAWING AND EDITING TOOLBOX -->
        <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Background="{DynamicResource {x:Static SystemColors.MenuBarBrushKey}}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="48"/>
                    <ColumnDefinition Width="48"/>
                    <ColumnDefinition Width="48"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="48"/>
                    <ColumnDefinition Width="48"/>
                    <ColumnDefinition Width="48"/>
                    <ColumnDefinition Width="12"/>
                    <ColumnDefinition Width="48"/>
                    <ColumnDefinition Width="48"/>
                    <ColumnDefinition Width="48"/>
                    <ColumnDefinition Width="48"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- BASIC FUNCTIONALITY -->
                <ToggleButton Grid.Column="1" HorizontalAlignment="Center" Height="48" Width="48"
                                IsChecked="{Binding ElementName=MainView, Path=ActionMode, Mode=OneWay, Converter={StaticResource ActionToBooleanConverter}, ConverterParameter=OPTIONS}"
                                Command="{Binding ElementName=MainView, Path=SwitchActionModeCmd}"
                                CommandParameter="OPTIONS"
                                Style="{DynamicResource ToggleButtonLight}"
                                ToolTip="Options"
                                x:Name="tool_Options">
                    <ToggleButton.Content>
                        <Image Source="./Data/Icons/options.png"/>
                    </ToggleButton.Content>
                </ToggleButton>
                <ToggleButton Grid.Column="2" HorizontalAlignment="Center" Height="48" Width="48"
                                IsChecked="{Binding ElementName=MainView, Path=ActionMode, Mode=OneWay, Converter={StaticResource ActionToBooleanConverter}, ConverterParameter=LINE_DRAW}"
                                Command="{Binding ElementName=MainView, Path=SwitchActionModeCmd}"
                                CommandParameter="LINE_DRAW"
                                Style="{DynamicResource ToggleButtonLight}"
                                ToolTip="Draw Line"
                                x:Name="tool_DrawLine">
                    <ToggleButton.Content>
                        <Image Source="./Data/Icons/line_draw.png"/>
                    </ToggleButton.Content>
                </ToggleButton>
                <ToggleButton Grid.Column="3" HorizontalAlignment="Center" Height="48" Width="48"
                                IsChecked="{Binding ElementName=MainView, Path=ActionMode, Mode=OneWay, Converter={StaticResource ActionToBooleanConverter}, ConverterParameter=LINE_EDIT}"
                                Command="{Binding ElementName=MainView, Path=SwitchActionModeCmd}"
                                CommandParameter="LINE_EDIT"
                                Style="{DynamicResource ToggleButtonLight}"
                                ToolTip="Edit Line"
                                x:Name="tool_EditLine">
                    <ToggleButton.Content>
                        <Image Source="./Data/Icons/line_edit.png"/>
                    </ToggleButton.Content>
                </ToggleButton>
                
                <!-- MAIN TOOLBOXES -->
                <ToggleButton Grid.Column="5" HorizontalAlignment="Center" Height="48" Width="48"
                                IsChecked="{Binding ElementName=MainView, Path=ActionMode, Mode=OneWay, Converter={StaticResource ActionToBooleanConverter}, ConverterParameter=ARCHITECTURE}"
                                Command="{Binding ElementName=MainView, Path=SwitchActionModeCmd}"
                                CommandParameter="ARCHITECTURE"
                                Style="{DynamicResource ToggleButtonLight_2}"
                                ToolTip="Edit Geometry"
                                x:Name="tool_Architecture">
                    <ToggleButton.Content>
                        <Image Source="./Data/Icons/tb_ARC.png"/>
                    </ToggleButton.Content>
                </ToggleButton>                
                <ToggleButton Grid.Column="6" HorizontalAlignment="Center" Height="48" Width="48"
                                IsChecked="{Binding ElementName=MainView, Path=ActionMode,Mode=OneWay, Converter={StaticResource ActionToBooleanConverter}, ConverterParameter=BUILDING_PHYSICS}"
                                Command="{Binding ElementName=MainView, Path=SwitchActionModeCmd}"
                                CommandParameter="BUILDING_PHYSICS"
                                Style="{DynamicResource ToggleButtonLight_2}"
                                ToolTip="Define Zones"
                                x:Name="tool_Building_Physics">
                    <ToggleButton.Content>
                        <Image Source="./Data/Icons/tb_defineZ.png"/>
                    </ToggleButton.Content>
                </ToggleButton>
                <ToggleButton Grid.Column="7" HorizontalAlignment="Left" Height="48" Width="48"                                
                                IsChecked="{Binding ElementName=MainView, Path=ActionMode, Mode=OneWay, Converter={StaticResource ActionToBooleanConverter}, ConverterParameter=SPACES_OPENINGS}"
                                Command="{Binding ElementName=MainView, Path=SwitchActionModeCmd}"
                                CommandParameter="SPACES_OPENINGS"
                                Style="{DynamicResource ToggleButtonLight_2}"
                                ToolTip="Place Components"
                                x:Name="tool_SpacesOpenings">
                    <ToggleButton.Content>
                        <Image Source="./Data/Icons/tb_placeC.png"/>
                    </ToggleButton.Content>
                </ToggleButton>

                <!-- NAVIGATION -->
                <Button Grid.Column="9" HorizontalAlignment="Center" Height="48" Width="48"
                                Command="{Binding ElementName=MainView, Path=PerformZoomExtentsCmd}"
                                Style="{DynamicResource ReliefButton}"
                                ToolTip="Zoom Extents">
                    <Button.Content>
                        <Image Source="./Data/Icons/zoom_2_ext.png"/>
                    </Button.Content>
                </Button>
                <Button Grid.Column="10" HorizontalAlignment="Center" Height="48" Width="48"
                                Command="{Binding ElementName=MainView, Path=PerformZoomSelectedCmd}"
                                Style="{DynamicResource ReliefButton}"
                                ToolTip="Zoom To Selection">
                    <Button.Content>
                        <Image Source="./Data/Icons/zoom_2_sel.png"/>
                    </Button.Content>
                </Button>
                
                <Button Grid.Column="11" HorizontalAlignment="Center" Height="48" Width="48"
                        Visibility="{Binding CameraIsPerspective, Mode=OneWay, Converter={StaticResource BoolToVisConverter}}"
                                Command="{Binding Path=SwitchCameraCmd}"
                                Style="{DynamicResource ReliefButton}"
                                ToolTip="Switch to Orthographic Camera">
                    <Button.Content>
                        <Image Source="./Data/Icons/camera_ortho.png"/>                          
                    </Button.Content>
                </Button>
                <Button Grid.Column="11" HorizontalAlignment="Center" Height="48" Width="48"
                        Visibility="{Binding CameraIsPerspective, Mode=OneWay, Converter={StaticResource ReverseBoolToVisConverterGroup}}"
                                Command="{Binding Path=SwitchCameraCmd}"
                                Style="{DynamicResource ReliefButton}"
                                ToolTip="Switch to Perspective Camera">
                    <Button.Content>
                        <Image Source="./Data/Icons/camera_persp.png"/>
                    </Button.Content>
                </Button>
                <ToggleButton Grid.Column="12" HorizontalAlignment="Center" Height="48" Width="48"
                                IsChecked="{Binding ElementName=MainView, Path=ActionMode, Mode=OneWay, Converter={StaticResource ActionToBooleanConverter}, ConverterParameter=NAVI_LOOK_AT}"
                                Command="{Binding ElementName=MainView, Path=SwitchActionModeCmd}"
                                CommandParameter="NAVI_LOOK_AT"
                                Style="{DynamicResource ToggleButtonLight}"
                                ToolTip="Look At">
                    <ToggleButton.Content>
                        <Image Source="./Data/Icons/look_at_1.png" diag:PresentationTraceSources.TraceLevel="High"/>
                    </ToggleButton.Content>
                </ToggleButton>
                
            </Grid>
        </StackPanel>
        
        <!-- WINDOW 3D VIEWPORT -->
        <gvx:Viewport3DXext
            Grid.Row="2"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            x:Name="MainView"
            Camera="{Binding Camera}"
            Title="{Binding Title}"
            SubTitle=""
            BackgroundColor="0.5, 0.5, 0.5, 1"
            ShowCoordinateSystem="False"
            CoordinateSystemLabelForeground="White"
            CoordinateSystemHeight="200"
            ViewCubeHorizontalPosition="Left" ViewCubeVerticalPosition="Top"
            ViewCubeHeight="100" ViewCubeWidth="100" ViewCubeOpacity="1"
            RenderTechnique="{Binding RenderTechnique}"
            TextBrush="Black" 
            EnableCurrentPosition="True"
            Margin="0,0,240,0">
            <gvx:Viewport3DXext.Resources>
                <!-- for data binding debugging -->
                <gvxut:Point3dToPoint3DConverter x:Key="debugConverter"/>
            </gvx:Viewport3DXext.Resources>

            <htx:AmbientLight3D Color="{Binding LightAmbientColor}"/>
            <htx:DirectionalLight3D Color="{Binding LightDiffuseColor}" Direction="{Binding Light1LookAt}"/>
            <htx:DirectionalLight3D Color="{Binding LightDiffuseColor}" Direction="{Binding Light2LookAt}"/>
            <htx:SpotLight3D Color="{Binding LightDiffuseColor}" Direction="{Binding Light3LookAt}" InnerAngle="30" OuterAngle="60"/>

            <!-- GRID -->
            <htx:LineGeometryModel3D x:Name="grid" Geometry="{Binding Grid}" Transform="{Binding GridTransform}" Thickness="0.5" Smoothness="0.0" Color="{Binding GridColor}" Tag="NON_ZOOMABLE"/>

            <!-- CONSTRUCTION PLANE -->
            <gvxht:UserMesh x:Name="ctrlP" Geometry="{Binding ConstrPlG}" Transform="{Binding GridTransform}" Material="{Binding ConstrPlM}" IsRendering="False"
                          SnapToGrid="{Binding SnapToGrid}" SnapMagnet="{Binding SnapMagnet}" Tag="NON_ZOOMABLE"
                          IsHitTestVisible="{Binding ElementName=MainView, Path=ActionMode, Mode=OneWay, Converter={StaticResource ActionToBooleanConverter}, ConverterParameter=LINE_DRAW+POINT_PLACE+NAVI_LOOK_AT}"/>

            <!-- CUSTOM ORIGIN-->
            <htx:LineGeometryModel3D Geometry="{Binding OriginLines}" Color="{Binding OriginColor}" Thickness="2" IsHitTestVisible="False" Tag="NON_ZOOMABLE"/>

            <!-- CONTAINER FOR DISPLAYED LINES AND DRAWING LINES -->
            <gvx:LineGenerator3D x:Name="lineGenerator"
                                 HitPointCp="{Binding HitPoint, ElementName=ctrlP}"
                                 HitPointPrevCp="{Binding HitPointPrev, ElementName=ctrlP}"
                                 NrConseqHitsCp="{Binding NrConseqHits, ElementName=ctrlP}"
                                 Coords0FromARC="{Binding Coords0ToLG, ElementName=arcDisplay}"
                                 Coords1FromARC="{Binding Coords1ToLG, ElementName=arcDisplay}"
                                 ConnectedFromARC="{Binding ConnectedToLG, ElementName=arcDisplay}"
                                 />

            <!-- CONTAINER FOR SELECTED LINES AND _GRAPHICAL_ LINE EDITING -->
            <gvx:LineManipulator3DGraphic x:Name="lineManipulator" IsPolyLineClosed="False" 
                                          DragX="{Binding IsChecked, ElementName=tb_dragX}"  
                                          DragY="{Binding IsChecked, ElementName=tb_dragY}"
                                          DragZ="{Binding IsChecked, ElementName=tb_dragZ}" 
                                          CoordsTargetIn="{Binding ElementName=lineGenerator, Path=CoordsSourceOut, Mode=OneWay}"
                                          CoordsTargetOut="{Binding ElementName=lineGenerator, Path=CoordsSourceIn, Mode=OneWayToSource}"
                                          SnapToGrid="{Binding SnapToGrid}"
                                          SnapMagnet="{Binding SnapMagnet}"
                                          CamPos="{Binding Camera.Position}"
                                          />

            <!-- CONTAINER FOR SELECTED LINES AND _NUMERICAL_ LINE EDITING -->
            <gvx:LineManipulator3DNumeric x:Name="lineManipulatorN" IsPolyLineClosed="False"
                                          CoordsTargetIn="{Binding ElementName=lineGenerator, Path=CoordsSourceOut, Mode=OneWay}"
                                          CoordsTargetOut="{Binding ElementName=lineGenerator, Path=CoordsSourceIn, Mode=OneWayToSource}"
                                          CamPos="{Binding Camera.Position}"
                                          />
            
            <!-- NEIGHBOR VOLUME DUAL GRAPH VISUALIZER-->
            <gvxso:NeighborhoodGraph x:Name="dgNeighborVolumes" VolumeManager="{Binding EManager_BPH, Mode=OneWay}" 
                                     VolumeManagerContentChange="{Binding ElementName=zoneGroupDisplay, Path=VolumeVisiblityChanged, Mode=OneWay}" 
                                     Tag="NON_ZOOMABLE"/>

            <!-- COMPONENT REPRESENTATION DISPLAY -->
            <gvx:ComponentDisplay x:Name="compDisplay" CompRepMANAGER="{Binding RManager_CompReps, Mode=OneWay}" IsHitTestVisible="False"/>
            
            <!-- ARCHITECTURE DISPLAY -->
            <gvx:ArchitectureDisplay x:Name="arcDisplay"
                                     InputLayers="{Binding DXFLayers}"
                                     InputGeom="{Binding DXFGeometry}"
                                     EManager="{Binding EManager_ARC, Mode=OneWay}"
                                     Coords0FromLG="{Binding ElementName=lineGenerator, Path=Coords0ToARC, Mode=OneWay}"
                                     Coords1FromLG="{Binding ElementName=lineGenerator, Path=Coords1ToARC, Mode=OneWay}"
                                     ConnectedFromLG="{Binding ElementName=lineGenerator, Path=ConnectedToARC, Mode=OneWay}"
                                     />
            
            <!-- BUILDING PHYSICS DISPLAY -->
            <gvx:ZoneGroupDisplay x:Name="zoneGroupDisplay"
                                  OpacityMap="{Binding OpacityMap, Mode=OneWay}"
                                  PolygonDefinitionIn="{Binding ElementName=arcDisplay, Path=PolygonChain, Mode=OneWay}"
                                  EManager="{Binding EManager_BPH, Mode=OneWay}"
                                  MLManager="{Binding MLManager, Mode=OneWay}"/>           

            <!-- TEST POLYGON TRIANGULATION -->
            <!--<gvxta:PolygonDisplay Tag="NON_ZOOMABLE"/>-->            
            <!--<gvx:VolumeDisplay/>-->
            <gvx:TriangulationDisplay x:Name="triangDisplay"
                                      SelectedPolygon="{Binding ElementName=zoneGroupDisplay, Path=SelectedEntity, Mode=OneWay, Converter={StaticResource EntityToZonedPolygonConverter}}"/>

            <!-- CAMERA VIEW FRUSTUM -->
            <gvxso:ViewFrustumFunctions x:Name="viewFrustumDispl" CurrentCam="{Binding Camera, Mode=OneWay}" Tag="NON_ZOOMABLE"/>

            <!-- Communication btw the DXF Imported Geometry Display and the CONTAINER FOR DISPLAYED LINES AND DRAWING LINES -->
            <gvxut:CommandExt x:Name="CommandExt"/>

            <!-- OCTTREE VISUALIZER -->
            <gvxso:OcTreeManager x:Name="ocTreeManager" LinesIn="{Binding ElementName=arcDisplay, Path=LinesToOcTree, Mode=OneWay}" Tag="NON_ZOOMABLE"/>
            
            

        </gvx:Viewport3DXext>
        <Rectangle Grid.Row="2" Grid.Column="1" MaxWidth="240" MinWidth="240" HorizontalAlignment="Right" IsHitTestVisible="False">
            <Rectangle.Fill>
                <SolidColorBrush Color="{Binding ElementName=MainView, Path=BackgroundColor, Mode=OneWay, Converter={StaticResource SharpDXColor4ToWinMediaColorConverter}}"/>
            </Rectangle.Fill>
        </Rectangle>

        <!-- WINDOW SECONDARY TOOLBOXES -->
        <ScrollViewer Grid.Row="2" Grid.Column="1" Margin="0" Width="Auto" Background="#26F0F0F0">
            <StackPanel>
                <Expander Header="Construction Environment" Style="{DynamicResource ViewportExpander}"
                          IsExpanded="True"
                          Visibility="{Binding ElementName=tool_Options, Path=IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisConverter}}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="5"/>
                        </Grid.RowDefinitions>

                        <CheckBox Grid.Row="0" IsChecked="{Binding IsRendering, ElementName=grid}" Margin="3">Grid Visible</CheckBox>
                        <gvxuie:ColorButton Grid.Row="0" HorizontalAlignment="Right" Margin="0,2,5,2" Height="21" Width="100" 
                                            Content="Backgr. Color"
                                            ManagedColor="{Binding ElementName=MainView, Path=BackgroundColor, Mode=OneWay, Converter={StaticResource SharpDXColorToWinMediaColorConverter}}"
                                            Command="{Binding ElementName=MainView, Path=SetBackgroundColorCmd}"
                                            ContentTemplate="{DynamicResource ColorButton}"
                                            Style="{DynamicResource ReliefButton}"/>
                        
                        <ComboBox Grid.Row="1" HorizontalAlignment="Left" Margin="10,0,0,0" Width="145" SelectedIndex="{Binding GridOrientation, Mode=OneWayToSource, Converter={StaticResource IntToOrientationConverter}}">
                            <ComboBoxItem IsSelected="True">XZ Plane</ComboBoxItem>
                            <ComboBoxItem>XY Plane</ComboBoxItem>
                            <ComboBoxItem>YZ Plane</ComboBoxItem>
                        </ComboBox>
                        
                        <TextBlock Grid.Row="2" Margin="10,5,0,2" HorizontalAlignment="Left" Width="100" Text="distance to Origin"/>
                        <TextBox Grid.Row="2" Margin="110,5,0,2" HorizontalAlignment="Left" 
                             Text="{Binding GridDistFRomOrigin, Mode=OneWayToSource, StringFormat=\{0:0.000\}, Converter={StaticResource DoubleToStringConverter}, FallbackValue=0}" 
                             Style="{DynamicResource CoordinateInput}"/>

                        <CheckBox Grid.Row="3" HorizontalAlignment="Left" Margin="10,8,0,2" IsChecked="{Binding SnapToGrid, Mode=OneWayToSource}">snap to grid</CheckBox>
                        <TextBox Grid.Row="3" Margin="110,5,0,2" HorizontalAlignment="Left"
                             Text="{Binding SnapMagnet, Mode=OneWayToSource, StringFormat=\{0:0.00\}, Converter={StaticResource DoubleToStringConverter}, FallbackValue=1.0}"
                             Style="{DynamicResource CoordinateInput}"/>                     
                        <TextBlock Grid.Row="3" HorizontalAlignment="Left" Margin="158,5,0,2" Text="magnet"/>
                        
                        <CheckBox Grid.Row="4" HorizontalAlignment="Left" Margin="10,8,0,2" IsChecked="{Binding ElementName=lineGenerator, Path=DisplayLineDir, Mode=OneWayToSource}">decorate lines</CheckBox>

                        <Separator Grid.Row="5" Background="#FF787878"/>
                        <!--<CheckBox Grid.Row="6" HorizontalAlignment="Left" Margin="10,8,0,2" FontWeight="Bold" IsChecked="{Binding ElementName=MainView, Path=ObjectSnapOn, Mode=OneWayToSource}">object snap</CheckBox>
                        <Image Grid.Row="7" HorizontalAlignment="Left" Margin="10,8,0,2" Height="12" Width="12" Source="./Data/Icons/object_snap_End.png"/>
                        <CheckBox Grid.Row="7" HorizontalAlignment="Left" Margin="30,8,0,2" IsChecked="{Binding ElementName=MainView, Path=SnapToEndPointsOn, Mode=OneWayToSource}">End points</CheckBox>
                        <Image Grid.Row="8" HorizontalAlignment="Left" Margin="10,8,0,2" Height="12" Width="12" Source="./Data/Icons/object_snap_Mid.png"/>
                        <CheckBox Grid.Row="8" HorizontalAlignment="Left" Margin="30,8,0,2" IsChecked="{Binding ElementName=MainView, Path=SnapToMidPointsOn, Mode=OneWayToSource}">edge Middle points</CheckBox>
                        <Image Grid.Row="9" HorizontalAlignment="Left" Margin="10,8,0,2" Height="12" Width="12" Source="./Data/Icons/object_snap_Int.png"/>
                        <CheckBox Grid.Row="9" HorizontalAlignment="Left" Margin="30,8,0,2" IsChecked="{Binding ElementName=MainView, Path=SnapToIntesectionPointsOn, Mode=OneWayToSource}">Intersection points</CheckBox>-->
                        
                        <Separator Grid.Row="10" Background="#FF787878"/>
                        <CheckBox Grid.Row="11" IsChecked="{Binding ElementName=ocTreeManager, Path=ShowTree, Mode=OneWayToSource}" Margin="3">OcTree Visible</CheckBox>
                        <Button Grid.Row="12" HorizontalAlignment="Left" Width="85" Height="23" Margin="10,2,0,2"
                                Style="{DynamicResource ReliefButton}"
                                Content="Update OT"
                                Command="{Binding ElementName=ocTreeManager, Path=UpdateOcTreeCmd}"/>
                        <Button Grid.Row="12" HorizontalAlignment="Right" Width="85" Height="23" Margin="0,2,5,2" 
                            Style="{DynamicResource ReliefButton}"
                            Content="Collision Check"
                            Command="{Binding ElementName=ocTreeManager, Path=CheckForCollisionsCmd}"/>
                        <Button Grid.Row="13" HorizontalAlignment="Left" Width="85" Height="23" Margin="10,2,0,2" 
                            Style="{DynamicResource ReliefButton}"
                            Content="Clean OT"
                            Command="{Binding ElementName=ocTreeManager, Path=CleanVisualAidsCmd}"/>
                        <Button Grid.Row="13" HorizontalAlignment="Right" Width="85" Height="23" Margin="0,2,5,2"
                                Style="{DynamicResource ReliefButton}"
                                Content="Visibility Check"
                                Command="{Binding ElementName=CommandExt, Path=DetermineOTVisibilityCmd}"/>

                        <Separator Grid.Row="14" Background="#FF787878"/>
                        <CheckBox Grid.Row="15" IsChecked="{Binding ElementName=viewFrustumDispl, Path=ShowFrustum, Mode=OneWayToSource}" Margin="3">Frustum Visible</CheckBox>
                        <ToggleButton Grid.Row="16" HorizontalAlignment="Left" Width="90" Height="23" Margin="10,2,0,2"
                                    Style="{DynamicResource ToggleButtonLight}"
                                  Content="Update VF"
                                  IsChecked="{Binding ElementName=viewFrustumDispl, Path=SynchrCam, Mode=TwoWay}"/>
                        <TextBlock Grid.Row="16" HorizontalAlignment="Right" Margin="0,5,5,0"  Width="80" Style="{DynamicResource CoordinateInfo}"
                                   Text="{Binding ElementName=viewFrustumDispl, Path=CurrentPos, StringFormat=\{0:0.00\}}"/>

                        <Separator Grid.Row="17" Background="#FF787878"/>
                        <CheckBox Grid.Row="18" IsChecked="{Binding ElementName=dgNeighborVolumes, Path=ShowNeighbors, Mode=OneWayToSource}" Margin="3">Neighbor volumes Visible</CheckBox>
                        <Button Grid.Row="19" Style="{StaticResource ReliefButton}" Height="26" Width="26" HorizontalAlignment="Left" Margin="10,2,0,2"
                                Command="{Binding ElementName=dgNeighborVolumes, Path=PerformNeighborhoodTestCmd, Mode=OneWay}"
                                ToolTip="build neighborhood graph">
                            <Button.Content>
                                <Image Source="./Data/Icons/neighbor_search.png" Height="24"/>
                            </Button.Content>
                            <Button.Effect>
                                <DropShadowEffect Color="{Binding ElementName=dgNeighborVolumes,Path=NeighborsUpToDate, Mode=OneWay, Converter={StaticResource BoolToWinMediaColorConverter}}" 
                                                  BlurRadius="3" ShadowDepth="3" Opacity="0.75"/>
                            </Button.Effect>
                        </Button>
                        <Image Grid.Row="19" HorizontalAlignment="Left" Margin="65,0,0,0" Source="./Data/Icons/switch_onOFF.png" Width="16"
                               ToolTip="Include objects on invisible layers"/>
                        <CheckBox Grid.Row="19" HorizontalAlignment="Left" Margin="82,8,0,0"
                                  IsChecked="{Binding ElementName=dgNeighborVolumes, Path=IncludeVolumesOnOFFLayers, Mode=TwoWay}"/>
                        <TextBox Grid.Row="19" Margin="110,5,0,2" HorizontalAlignment="Left"
                             Text="{Binding ElementName=dgNeighborVolumes, Path=MaxOverlapError, Mode=TwoWay, StringFormat=\{0:0.00\}, Converter={StaticResource DoubleToStringConverter}, FallbackValue=0.25}"
                             Style="{StaticResource CoordinateInput}"/>
                        <TextBlock Grid.Row="19" HorizontalAlignment="Left" Margin="158,5,0,2" Text="margin"/>

                    </Grid>
                </Expander>
                <Expander Header="Generate Line" Style="{DynamicResource ViewportExpander}"
                          IsExpanded="{Binding ElementName=tool_DrawLine, Path=IsChecked, Mode=OneWay}"
                          Visibility="{Binding ElementName=tool_DrawLine, Path=IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisConverter}}"
                          IsEnabled="{Binding ElementName=MainView, Path=LoggedUser, Mode=OneWay, Converter={StaticResource UserRoleToBooleanConverter}, ConverterParameter=ALL_RIGHTS+DRAWING_RIGHTS}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="5"/>
                        </Grid.RowDefinitions>

                        <ToggleButton x:Name="tb_dm" Grid.Row="0" HorizontalAlignment="Left" Margin="10,2,0,2" Content="Draw Line" ToolTip="Turns on line draw mode." IsChecked="{Binding DrawMode, ElementName=lineGenerator, Mode=TwoWay}" Style="{DynamicResource ToggleButtonLight}"/>
                        <CheckBox Grid.Row="0" HorizontalAlignment="Left" Margin="110,8,0,2" IsChecked="{Binding NewPointConnected, ElementName=lineGenerator, Mode=OneWayToSource}">connected</CheckBox>

                        <TextBlock Grid.Row="1" Text="{Binding NrConseqHits, ElementName=ctrlP, Mode=OneWay}" Margin="0,2,10,0" Height="22" VerticalAlignment="Top" HorizontalAlignment="Right" Width="20" Foreground="DimGray"/>

                        <Border Grid.Row="2" Margin="10,2,0,0" Width="45" Style="{DynamicResource CoordinateInfoBorder}">
                            <TextBlock Text="{Binding HitPointPrev.X, ElementName=ctrlP, Mode=OneWay, StringFormat=\{0:0.000\}}" Width="43" Style="{DynamicResource CoordinateInfo}"/>
                        </Border>
                        <Border Grid.Row="2" Margin="60,2,0,0" Width="45" Style="{DynamicResource CoordinateInfoBorder}">
                            <TextBlock Text="{Binding HitPointPrev.Y, ElementName=ctrlP, Mode=OneWay, StringFormat=\{0:0.000\}}" Width="43" Style="{DynamicResource CoordinateInfo}"/>
                        </Border>
                        <Border Grid.Row="2" Margin="110,2,0,0" Width="45" Style="{DynamicResource CoordinateInfoBorder}">
                            <TextBlock Text="{Binding HitPointPrev.Z, ElementName=ctrlP, Mode=OneWay, StringFormat=\{0:0.000\}}" Width="43" Style="{DynamicResource CoordinateInfo}"/>
                        </Border>
                        <TextBlock Grid.Row="2" Text="P1" Height="20" Margin="0,2,10,0" VerticalAlignment="Top" HorizontalAlignment="Right" Width="20" Foreground="DimGray"/>

                        <Border Grid.Row="3" Margin="10,2,0,0" Width="45" Style="{DynamicResource CoordinateInfoBorder}">
                            <TextBlock Text="{Binding HitPoint.X, ElementName=ctrlP, Mode=OneWay, StringFormat=\{0:0.000\}}" Width="43" Style="{DynamicResource CoordinateInfo}"/>
                        </Border>
                        <Border Grid.Row="3" Margin="60,2,0,0" Width="45" Style="{DynamicResource CoordinateInfoBorder}">
                            <TextBlock Text="{Binding HitPoint.Y, ElementName=ctrlP, Mode=OneWay, StringFormat=\{0:0.000\}}" Width="43" Style="{DynamicResource CoordinateInfo}"/>
                        </Border>
                        <Border Grid.Row="3" Margin="110,2,0,0" Width="45" Style="{DynamicResource CoordinateInfoBorder}">
                            <TextBlock Text="{Binding HitPoint.Z, ElementName=ctrlP, Mode=OneWay, StringFormat=\{0:0.000\}}" Width="43" Style="{DynamicResource CoordinateInfo}"/>
                        </Border>
                        <TextBlock Grid.Row="3" Text="P2" Height="20" Margin="0,2,10,0" VerticalAlignment="Top" HorizontalAlignment="Right" Width="20" Foreground="DimGray"/>


                        <TextBox Grid.Row="4" Text="{Binding UserX, ElementName=lineGenerator, Mode=OneWayToSource, StringFormat=\{0:0.000\}, Converter={StaticResource DoubleToStringConverter}, FallbackValue=0.0}" 
                             Margin="10,2,0,0" Style="{DynamicResource CoordinateInput}" IsEnabled="{Binding IsChecked, ElementName=tb_dm}"/>
                        <TextBox Grid.Row="4" Text="{Binding UserY, ElementName=lineGenerator, Mode=OneWayToSource, StringFormat=\{0:0.000\}, Converter={StaticResource DoubleToStringConverter}, FallbackValue=0.0}" 
                             Margin="60,2,0,0" Style="{DynamicResource CoordinateInput}" IsEnabled="{Binding IsChecked, ElementName=tb_dm}"/>
                        <TextBox Grid.Row="4" Text="{Binding UserZ, ElementName=lineGenerator, Mode=OneWayToSource, StringFormat=\{0:0.000\}, Converter={StaticResource DoubleToStringConverter}, FallbackValue=0.0}" 
                             Margin="110,2,0,0" Style="{DynamicResource CoordinateInput}" IsEnabled="{Binding IsChecked, ElementName=tb_dm}"/>
                        <Button Grid.Row="4" HorizontalAlignment="Right" Width="20" Margin="0,2,13,0" Content="PN" Style="{DynamicResource ReliefButton}" 
                            IsEnabled="{Binding IsChecked, ElementName=tb_dm}" Command="{Binding PlaceNumericalPointCmd, ElementName=lineGenerator}"/>


                    </Grid>
                </Expander>
                <Expander Header="Edit Geometry" Style="{DynamicResource ViewportExpander}"
                          IsExpanded="{Binding ElementName=tool_EditLine, Path=IsChecked, Mode=OneWay}"
                          Visibility="{Binding ElementName=tool_EditLine, Path=IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisConverter}}"
                          IsEnabled="{Binding ElementName=MainView, Path=LoggedUser, Mode=OneWay, Converter={StaticResource UserRoleToBooleanConverter}, ConverterParameter=ALL_RIGHTS+DRAWING_RIGHTS}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="5"/>
                        </Grid.RowDefinitions>

                        <CheckBox x:Name="chb_delta" Grid.Row="0" Height="20" Margin="5,5,0,0">
                            <CheckBox.Content>
                                explicit delta
                            </CheckBox.Content>
                            <CheckBox.IsEnabled>
                                <MultiBinding Converter="{StaticResource BoolAndConverter}" ConverterParameter="{StaticResource TrueValue}" UpdateSourceTrigger="PropertyChanged" Mode="OneWay">
                                    <Binding ElementName="lineManipulator" Path="IsSelected"/>
                                    <Binding ElementName="lineManipulatorN" Path="IsSelected" />
                                </MultiBinding>
                            </CheckBox.IsEnabled>
                            <CheckBox.IsChecked>
                                <MultiBinding Converter="{StaticResource CloneConverter}" UpdateSourceTrigger="PropertyChanged" Mode="OneWayToSource">
                                    <Binding ElementName="lineManipulator" Path="InputNumeric"/>
                                    <Binding ElementName="lineManipulatorN" Path="InputNumeric"/>
                                </MultiBinding>
                            </CheckBox.IsChecked>
                        </CheckBox>

                        <TextBlock Grid.Row="1" HorizontalAlignment="Left" Height="20" Margin="2,5,0,0" Text="dX:"/>
                        <TextBox Grid.Row="1" Margin="20,5,0,2" Width="45" Style="{DynamicResource CoordinateInput}" IsEnabled="{Binding ElementName=chb_delta, Path=IsChecked}"
                                 Text="{Binding ElementName=lineManipulatorN, Path=DeltaX, Mode=OneWayToSource, Converter={StaticResource DoubleToStringConverter}, StringFormat=\{0:0.0000\}, FallbackValue=0.0}" />
                        <TextBlock Grid.Row="1" HorizontalAlignment="Left" Height="20" Margin="67,5,0,0" Text="dY:"/>
                        <TextBox Grid.Row="1" Margin="85,5,0,2" Width="45" Style="{DynamicResource CoordinateInput}" IsEnabled="{Binding ElementName=chb_delta, Path=IsChecked}"
                                 Text="{Binding ElementName=lineManipulatorN, Path=DeltaY, Mode=OneWayToSource, Converter={StaticResource DoubleToStringConverter}, StringFormat=\{0:0.0000\}, FallbackValue=0.0}" />
                        <TextBlock Grid.Row="1" HorizontalAlignment="Left" Height="20" Margin="132,5,0,0" Text="dZ:"/>
                        <TextBox Grid.Row="1" Margin="150,5,0,2" Width="45" Style="{DynamicResource CoordinateInput}" IsEnabled="{Binding ElementName=chb_delta, Path=IsChecked}"
                                 Text="{Binding ElementName=lineManipulatorN, Path=DeltaZ, Mode=OneWayToSource, Converter={StaticResource DoubleToStringConverter}, StringFormat=\{0:0.0000\}, FallbackValue=0.0}" />

                        <Button Grid.Row="2" HorizontalAlignment="Left" Margin="5,5,2,5" Height="25" Width="60" Content="Apply" 
                                Command="{Binding ElementName=lineManipulatorN, Path=ApplyDeltaToHandleCmd}"
                                Style="{DynamicResource ReliefButton}"/>

                        <TextBlock Grid.Row="3" HorizontalAlignment="Left" Height="20" Margin="5,0,0,0" Text="grip manipulation"/>
                        <ToggleButton x:Name="tb_dragX" Grid.Row="4" Content="along X" HorizontalAlignment="Left" Margin="5,2,0,2" Width="60" IsChecked="False" Style="{DynamicResource ToggleButtonLight}" 
                                      IsEnabled="{Binding ElementName=chb_delta, Path=IsChecked, Converter={StaticResource InvBoolConverter}}"/>
                        <ToggleButton x:Name="tb_dragY" Grid.Row="4" Content="along Y" HorizontalAlignment="Left" Margin="70,2,0,2" Width="60" IsChecked="False" Style="{DynamicResource ToggleButtonLight}"
                                      IsEnabled="{Binding ElementName=chb_delta, Path=IsChecked, Converter={StaticResource InvBoolConverter}}"/>
                        <ToggleButton x:Name="tb_dragZ" Grid.Row="4" Content="along Z" HorizontalAlignment="Left" Margin="135,2,0,2" Width="60" IsChecked="False" Style="{DynamicResource ToggleButtonLight}"
                                      IsEnabled="{Binding ElementName=chb_delta, Path=IsChecked, Converter={StaticResource InvBoolConverter}}"/>

                        <Border Grid.Row="5" Margin="5,2,0,2" Style="{DynamicResource CoordinateInfoBorder}">
                            <TextBlock x:Name="txt_dragX"  Text="{Binding DeltaTransf.X, ElementName=lineManipulator, StringFormat=\{0:0.0000\}}"  Style="{DynamicResource CoordinateInfo}"/>
                        </Border>
                        <Border Grid.Row="5" Margin="70,2,0,2" Style="{DynamicResource CoordinateInfoBorder}">
                            <TextBlock x:Name="txt_dragY"  Text="{Binding DeltaTransf.Y, ElementName=lineManipulator, StringFormat=\{0:0.0000\}}"  Style="{DynamicResource CoordinateInfo}"/>
                        </Border>
                        <Border Grid.Row="5" Margin="135,2,0,2" Style="{DynamicResource CoordinateInfoBorder}">
                            <TextBlock x:Name="txt_dragZ"  Text="{Binding DeltaTransf.Z, ElementName=lineManipulator, StringFormat=\{0:0.0000\}}"  Style="{DynamicResource CoordinateInfo}"/>
                        </Border>
                        <Separator Grid.Row="6" Background="#FF787878"/>

                        <TextBlock Grid.Row="7" HorizontalAlignment="Left" Margin="5,4,0,0" Width="60" Height="20" Text="Tolerance" TextAlignment="Left"/>
                        <Slider x:Name="sl_break"  Grid.Row="7" HorizontalAlignment="Left" Margin="70,4,0,0" Width="120" TickPlacement="BottomRight" Maximum="2" Minimum="0.125" SelectionEnd="1" SelectionStart="0.25"
                                Ticks="0.125 0.25 0.375 0.5 0.625 0.75 0.875 1 1.25 1.5 1.75 2" Cursor="Hand" IsSelectionRangeEnabled="True" Value="{Binding ElementName=lineGenerator, Path=BreakingTolerance, Mode=OneWayToSource}" Style="{DynamicResource SliderStyleOrange}" IsSnapToTickEnabled="True"/>
                        <Border Grid.Row="8" Margin="135,2,0,2" Style="{DynamicResource CoordinateInfoBorder}">
                            <TextBlock Style="{DynamicResource CoordinateInfo}" Text="{Binding ElementName=sl_break, Path=Value, Converter={StaticResource DoubleToStringConverter}, StringFormat=\{0:0.000\}}" />
                        </Border>
                        <ToggleButton x:Name="tb_break" Grid.Row="8" HorizontalAlignment="Left" Margin="5,2,0,2" Width="60" Content="Break" ToolTip="Turns on point braking mode." 
                                      IsChecked="{Binding BreakPointMode, ElementName=lineGenerator, Mode=TwoWay}" Style="{DynamicResource ToggleButtonLight}"/>
                        <ToggleButton x:Name="tb_weld" Grid.Row="8" HorizontalAlignment="Left" Margin="70,2,0,2" Width="60" Content="Weld" ToolTip="Turns on point welding mode." 
                                      IsChecked="{Binding WeldPointMode, ElementName=lineGenerator, Mode=TwoWay}" Style="{DynamicResource ToggleButtonLight}"/>
                    </Grid>
                </Expander>
                <Expander Header="Architecture" Style="{DynamicResource ViewportExpander}"                         
                          IsExpanded="{Binding ElementName=tool_Architecture, Path=IsChecked, Mode=OneWay}"
                          Visibility="{Binding ElementName=tool_Architecture, Path=IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisConverter}}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="5"/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="Auto" MinHeight="100" MaxHeight="500"/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="5"/>
                        </Grid.RowDefinitions>
                        
                        <StackPanel Grid.Row="1" HorizontalAlignment="Left" Margin="5,0,0,5" Orientation="Horizontal"
                                    IsEnabled="{Binding ElementName=MainView, Path=LoggedUser, Mode=OneWay, Converter={StaticResource UserRoleToBooleanConverter}, ConverterParameter=ALL_RIGHTS+DRAWING_RIGHTS}">
                            <Button HorizontalAlignment="Left" Height="26" Width="26"
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=arcDisplay, Path=SortLayersCmd}"
                                ToolTip="Sort Layers">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_layerSORT.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0" 
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=arcDisplay, Path=CreateNewLayerCmd, Mode=OneWay}"
                                IsEnabled="{Binding ElementName=arcDisplay, Path=EditMode, Mode=OneWay, Converter={StaticResource InvBoolConverter}}"
                                ToolTip="New Layer">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_allNEW1.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=arcDisplay, Path=DeleteSelectedEntityCmd, Mode=OneWay}"
                                CommandParameter="GeometryViewer.EntityGeometry.Layer"
                                IsEnabled="{Binding ElementName=arcDisplay, Path=EditMode, Mode=OneWay, Converter={StaticResource InvBoolConverter}}"
                                ToolTip="Delete Layer">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_allDEL1.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=arcDisplay, Path=DeleteSelectedEntityCmd, Mode=OneWay}"
                                CommandParameter="GeometryViewer.EntityGeometry.ArchitecturalLine+GeometryViewer.EntityGeometry.ArchitecturalText"
                                IsEnabled="{Binding ElementName=arcDisplay, Path=EditMode, Mode=OneWay, Converter={StaticResource InvBoolConverter}}"
                                ToolTip="Delete Line">
                                <Button.Content>
                                    <Image Source="./Data/Icons/edit_geometry_DEL.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=arcDisplay, Path=SwitchVisibilityForAllCmd}"
                                CommandParameter="{StaticResource TrueValue}"
                                IsEnabled="{Binding ElementName=arcDisplay, Path=EditMode, Mode=OneWay, Converter={StaticResource InvBoolConverter}}"
                                ToolTip="All Layers ON">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_allON1.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=arcDisplay, Path=SwitchVisibilityForAllCmd}"
                                CommandParameter="{StaticResource FalseValue}"
                                IsEnabled="{Binding ElementName=arcDisplay, Path=EditMode, Mode=OneWay, Converter={StaticResource InvBoolConverter}}"
                                ToolTip="All Layers OFF">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_allOFF1.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=arcDisplay, Path=SwitchVisibilityForAllCmd}"
                                CommandParameter="{StaticResource FalseValue}"
                                IsEnabled="{Binding ElementName=arcDisplay, Path=EditMode, Mode=OneWay, Converter={StaticResource InvBoolConverter}}"
                                ToolTip="All Layers OFF">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_allOFF1.png"/>
                                </Button.Content>
                            </Button>
                        </StackPanel>
                        
                        <StackPanel Grid.Row="2" HorizontalAlignment="Left" Orientation="Horizontal" Margin="5,0,0,5"
                                    IsEnabled="{Binding ElementName=MainView, Path=LoggedUser, Mode=OneWay, Converter={StaticResource UserRoleToBooleanConverter}, ConverterParameter=ALL_RIGHTS+DRAWING_RIGHTS}">
                            <Button HorizontalAlignment="Left" Height="26" Width="26" 
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=CommandExt, Path=TransferSingleFromArcToEditCmd}"
                                ToolTip="Edit Selected">
                                <Button.IsEnabled>
                                    <MultiBinding Converter="{StaticResource BoolAndConverter}" ConverterParameter="{StaticResource FalseValue}" UpdateSourceTrigger="PropertyChanged" Mode="OneWay">
                                        <Binding ElementName="arcDisplay" Path="EditMode" Mode="OneWay" Converter="{StaticResource InvBoolConverter}"/>
                                        <Binding ElementName="arcDisplay" Path="SelectedEntity" Mode="OneWay" Converter="{StaticResource TypeToBoolConverter}" ConverterParameter="GeometryViewer.EntityGeometry.ArchitecturalLine"/>
                                    </MultiBinding>
                                </Button.IsEnabled>
                                <Button.Content>
                                    <Image Source="./Data/Icons/edit_geometry_EDIT.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Margin="2,0,0,0" Height="26" Width="26"
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=CommandExt, Path=TransferSingleFromEditToArcCmd}"
                                ToolTip="Finish Editing"
                                >
                                <Button.Content>
                                    <Image Source="./Data/Icons/edit_geometry_DONE.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Margin="2,0,0,0" Height="26" Width="26"
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=arcDisplay,Path=CopySelectedEntityCmd, Mode=OneWay}"
                                ToolTip="Copy Selected"
                                >
                                <Button.Content>
                                    <Image Source="./Data/Icons/edit_geometry_COPY.png"/>
                                </Button.Content>
                                <Button.IsEnabled>
                                    <MultiBinding Converter="{StaticResource BoolAndConverter}" ConverterParameter="{StaticResource FalseValue}" UpdateSourceTrigger="PropertyChanged" Mode="OneWay">
                                        <Binding ElementName="arcDisplay" Path="EditMode" Mode="OneWay" Converter="{StaticResource InvBoolConverter}"/>
                                        <Binding ElementName="arcDisplay" Path="SelectedEntity" Mode="OneWay" Converter="{StaticResource TypeToBoolConverter}" ConverterParameter="GeometryViewer.EntityGeometry.ArchitecturalLine"/>
                                    </MultiBinding>
                                </Button.IsEnabled>
                            </Button>
                            <ToggleButton HorizontalAlignment="Left" Margin="2,0,0,0" Height="26" Width="26"
                                Style="{DynamicResource ToggleButtonLight}"
                                IsChecked="{Binding ElementName=arcDisplay, Path=PropertiesTransferMode, Mode=TwoWay}"
                                ToolTip="Transfer Properties From Selected Line"
                                >
                                <ToggleButton.Content>
                                    <Image Source="./Data/Icons/edit_geometry_PROPTRANSF.png"/>
                                </ToggleButton.Content>
                                <ToggleButton.IsEnabled>
                                    <MultiBinding Converter="{StaticResource BoolAndConverter}" ConverterParameter="{StaticResource FalseValue}" UpdateSourceTrigger="PropertyChanged" Mode="OneWay">
                                        <Binding ElementName="arcDisplay" Path="EditMode" Mode="OneWay" Converter="{StaticResource InvBoolConverter}"/>
                                        <Binding ElementName="arcDisplay" Path="SelectedEntity" Mode="OneWay" Converter="{StaticResource TypeToBoolConverter}" ConverterParameter="GeometryViewer.EntityGeometry.ArchitecturalLine"/>
                                    </MultiBinding>
                                </ToggleButton.IsEnabled>
                            </ToggleButton>
                            <Button HorizontalAlignment="Left" Margin="2,0,0,0" Height="26" Width="26"
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=CommandExt, Path=TransferSingleFromArcToZoneDisplayCmd}"
                                ToolTip="Convert To Space"
                                >
                                <Button.Content>
                                    <Image Source="./Data/Icons/edit_geometry_TOZONE.png"/>
                                </Button.Content>
                                <Button.IsEnabled>
                                    <MultiBinding Converter="{StaticResource BoolAndConverter}" ConverterParameter="{StaticResource FalseValue}" UpdateSourceTrigger="PropertyChanged" Mode="OneWay">
                                        <Binding ElementName="arcDisplay" Path="EditMode" Mode="OneWay" Converter="{StaticResource InvBoolConverter}"/>
                                        <Binding ElementName="arcDisplay" Path="SelectedEntity" Mode="OneWay" Converter="{StaticResource TypeToBoolConverter}" ConverterParameter="GeometryViewer.EntityGeometry.ArchitecturalLine"/>
                                    </MultiBinding>
                                </Button.IsEnabled>
                            </Button>
                        </StackPanel>                        

                        <TreeView Grid.Row="3" x:Name="tv_Architecture" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                                  Margin="5,0" MinWidth="185" Width="Auto" Height="Auto"
                                  IsEnabled="{Binding ElementName=arcDisplay, Path=EditMode, Mode=OneWay, Converter={StaticResource InvBoolConverter}}" 
                                  ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                                  ScrollViewer.VerticalScrollBarVisibility="Visible"
                                  ItemsSource="{Binding ElementName=arcDisplay, Path=ZoneLayers, Mode=TwoWay, Converter={StaticResource TreeViewSortingEntityConverter}, ConverterParameter=EntityName}" 
                                  ItemTemplate="{DynamicResource ArchInList}"
                                  ItemContainerStyle="{DynamicResource TreeItemForLayers}"
                                  >
                            <i:Interaction.Behaviors>
                                <!-- the SelectedItem Property is READONLY -->
                                <gvxuie:BindableSelectedItemBehavior SelectedItem="{Binding ElementName=arcDisplay, Path=SelectedEntity, Mode=TwoWay}"/>
                            </i:Interaction.Behaviors>
                            <TreeView.Resources>
                                <Style TargetType="{x:Type TreeViewItem}">
                                    <Setter Property="HorizontalContentAlignment" Value="Left" />
                                    <Setter Property="VerticalContentAlignment" Value="Center" />
                                </Style>
                            </TreeView.Resources>
                            <!--<TreeView.InputBindings>
                                <KeyBinding Key="Delete" Command="{Binding ElementName=zoneGroupDisplay, Path=DeleteSelectedEntityCmd, Mode=OneWay}"/>
                            </TreeView.InputBindings>-->
                        </TreeView>
                        <GridSplitter Grid.Row="4" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="5,0" Height="3" ResizeDirection="Rows"
                                       Background="{DynamicResource {x:Static SystemColors.MenuBarBrushKey}}" 
                                       BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkDarkBrushKey}}"
                                       BorderThickness="1"/>

                        <TextBlock Grid.Row="5" HorizontalAlignment="Stretch" Height="25" Margin="5,5,5,0" 
                                   TextAlignment="Left"
                                   Padding="0,0,2,0"
                                   Text="{Binding ElementName=tv_Architecture, Path=SelectedItem.EntityName, StringFormat=Selected: \{0\}}"
                                   FontWeight="Bold"/>
                        
                        <DockPanel Grid.Row="6" HorizontalAlignment="Stretch" LastChildFill="True" Margin="5,0,5,5"
                                   IsEnabled="{Binding ElementName=MainView, Path=LoggedUser, Mode=OneWay, Converter={StaticResource UserRoleToBooleanConverter}, ConverterParameter=ALL_RIGHTS+DRAWING_RIGHTS}">
                            <TextBlock HorizontalAlignment="Left" Height="20" Width="40" Text="Name: " DockPanel.Dock="Left"/>
                            <TextBox Grid.Row="6" HorizontalAlignment="Stretch" Height="25" Width="Auto"
                                 Style="{DynamicResource CoordinateInput}" 
                                 IsEnabled="{Binding ElementName=arcDisplay, Path=EditMode, Mode=OneWay, Converter={StaticResource InvBoolConverter}}"
                                 Text="{Binding ElementName=arcDisplay, Path=SelectedEntity.EntityName, Mode=TwoWay}"/>
                        </DockPanel>
                        
                        <DockPanel Grid.Row="7" HorizontalAlignment="Stretch" LastChildFill="True" Margin="5,0,5,5"
                                   IsEnabled="{Binding ElementName=MainView, Path=LoggedUser, Mode=OneWay, Converter={StaticResource UserRoleToBooleanConverter}, ConverterParameter=ALL_RIGHTS+DRAWING_RIGHTS}">
                            <TextBlock HorizontalAlignment="Left" Height="22" Width="40" Text="Layer: " DockPanel.Dock="Left"/>
                            <ComboBox HorizontalAlignment="Stretch" Height="25" 
                                  ItemsSource="{Binding ElementName=arcDisplay, Path=ZoneLayersFlat}"
                                  ItemTemplate="{DynamicResource ZoneInComboBox}"
                                  SelectedItem="{Binding ElementName=arcDisplay, Path=LayerOfSelectedEntity, Mode=TwoWay}"
                                  IsEnabled="{Binding ElementName=arcDisplay, Path=EditMode, Mode=OneWay, Converter={StaticResource InvBoolConverter}}"
                                >
                                <ComboBox.ItemContainerStyle>
                                    <Style TargetType="{x:Type ComboBoxItem}">
                                        <Setter Property="HorizontalContentAlignment" Value="Left" />
                                        <Setter Property="VerticalContentAlignment" Value="Center" />
                                    </Style>
                                </ComboBox.ItemContainerStyle>
                            </ComboBox>
                        </DockPanel>

                        <DockPanel Grid.Row="8" HorizontalAlignment="Stretch" LastChildFill="True" Margin="5,0,5,5"
                                   IsEnabled="{Binding ElementName=MainView, Path=LoggedUser, Mode=OneWay, Converter={StaticResource UserRoleToBooleanConverter}, ConverterParameter=ALL_RIGHTS+DRAWING_RIGHTS}">
                            <TextBlock HorizontalAlignment="Left" Height="20" Width="60"
                                   TextAlignment="Left" Padding="0,0,2,0"
                                   Text="Thickness:"/>
                            <ListBox HorizontalAlignment="Stretch" Height="25" Width="Auto" Margin="50,0,0,0"
                                 ItemsSource="{Binding ElementName=arcDisplay, Path=LineThicknessCollection, Mode=OneWay}"
                                 ItemStringFormat="0.00"
                                 SelectedItem="{Binding ElementName=arcDisplay, Path=ThicknessOfSelectedEntity, Mode=TwoWay}" 
                                 IsSynchronizedWithCurrentItem="True"
                                 ItemContainerStyle="{DynamicResource ListBoxNumberOrange}"
                                 IsEnabled="{Binding ElementName=arcDisplay, Path=EditMode, Mode=OneWay, Converter={StaticResource InvBoolConverter}}"
                                 />
                        </DockPanel>


                        <StackPanel Grid.Row="9">
                            <StackPanel.IsEnabled>
                                <MultiBinding Converter="{StaticResource BoolAndConverter}" ConverterParameter="{StaticResource FalseValue}" UpdateSourceTrigger="PropertyChanged" Mode="OneWay">
                                    <Binding ElementName="arcDisplay" Path="SelectedEntity" Mode="OneWay" Converter="{StaticResource TypeToBoolConverter}" ConverterParameter="GeometryViewer.EntityGeometry.ArchitecturalText"/>
                                    <Binding ElementName="MainView" Path="LoggedUser" Mode="OneWay" Converter="{StaticResource UserRoleToBooleanConverter}" ConverterParameter="ALL_RIGHTS+DRAWING_RIGHTS"/>
                                </MultiBinding>
                            </StackPanel.IsEnabled>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" HorizontalAlignment="Left" Margin="5,5,0,0" Height="20" Width="40" Text="Text: "/>
                                <Button Grid.Row="1" HorizontalAlignment="Left" Height="25" Width="35" Margin="5,5,0,0"
                                        Content="Save"
                                        Command="{Binding ElementName=arcDisplay, Path=UpdateAfterTextEditCmd, Mode=OneWay}"
                                        CommandParameter="{Binding ElementName=arcDisplay, Path=SelectedEntity.ID, Mode=OneWay}"
                                        IsEnabled="{Binding ElementName=arcDisplay, Path=EditMode, Mode=OneWay, Converter={StaticResource InvBoolConverter}}"
                                        Style="{DynamicResource ReliefButton}"/>
                                <TextBox Grid.Row="0" Grid.RowSpan="2" HorizontalAlignment="Stretch" Margin="45,5,5,0" Height="50" Width="Auto"
                                        IsEnabled="{Binding ElementName=arcDisplay, Path=EditMode, Mode=OneWay, Converter={StaticResource InvBoolConverter}}"
                                        Text="{Binding ElementName=arcDisplay, Path=SelectedEntity.Text, Mode=TwoWay, Converter={StaticResource ListOfStringsToStringConverter}}"/>

                            </Grid>
                        </StackPanel>
                        

                        <TextBlock Grid.Row="11" HorizontalAlignment="Left" Margin="5,5,0,0" Height="20" Width="40"
                                   TextAlignment="Left" Padding="0,0,2,0" FontWeight="Bold"
                                   Text="Search"/>
                        <TextBox Grid.Row="11" HorizontalAlignment="Stretch" Height="25" Width="Auto" Margin="45,5,47,0"
                                 x:Name="txt_arc_search_text"
                                 Style="{DynamicResource CoordinateInput}"
                                 IsEnabled="{Binding ElementName=arcDisplay, Path=EditMode, Mode=OneWay, Converter={StaticResource InvBoolConverter}}"
                                 Text="{Binding ElementName=arcDisplay, Path=SearchText, Mode=OneWayToSource}"/>
                        <Button Grid.Row="11" HorizontalAlignment="Right" Height="25" Width="40" Margin="0,5,5,0"
                                Content="Find"
                                Command="{Binding ElementName=arcDisplay, Path=SearchByNameCmd, Mode=OneWay}"
                                CommandParameter="{Binding ElementName=txt_arc_search_text, Path=Text, Mode=OneWay}"
                                IsEnabled="{Binding ElementName=arcDisplay, Path=EditMode, Mode=OneWay, Converter={StaticResource InvBoolConverter}}"
                                Style="{DynamicResource ReliefButton}"/>


                    </Grid>
                </Expander>
                <Expander Header="Building Physics" Style="{DynamicResource ViewportExpander}"
                          IsExpanded="{Binding ElementName=tool_Building_Physics, Path=IsChecked, Mode=OneWay}"
                          Visibility="{Binding ElementName=tool_Building_Physics, Path=IsChecked, Converter={StaticResource BoolToVisConverter}, Mode=OneWay}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="5"/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="Auto" MinHeight="100" MaxHeight="500"/>                   
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="5"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Layer Controls -->
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="5,0,0,5"
                                    IsEnabled="{Binding ElementName=MainView, Path=LoggedUser, Mode=OneWay, Converter={StaticResource UserRoleToBooleanConverter}, ConverterParameter=ALL_RIGHTS+DRAWING_RIGHTS+ZONING_RIGHTS+INSERTION_RIGHTS+LAYER_VIS_RIGHTS}">
                            <Button HorizontalAlignment="Left" Height="26" Width="26"
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=SortLayersCmd}"
                                ToolTip="Sort Layers">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_layerSORT.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0" 
                                Style="{DynamicResource ReliefButton}"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=CreateNewLayerCmd, Mode=OneWay}"
                                ToolTip="New Layer">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_allNEW1.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                Style="{DynamicResource ReliefButton}"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=DeleteSelectedEntityCmd, Mode=OneWay}"
                                CommandParameter="GeometryViewer.EntityGeometry.Layer"
                                ToolTip="Delete Layer">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_allDEL1.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                Style="{DynamicResource ReliefButton}"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchVisibilityForAllCmd}"
                                CommandParameter="{StaticResource TrueValue}"
                                ToolTip="All Layers and All Geometry ON">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_allON1.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                Style="{DynamicResource ReliefButton}"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchVisibilityForAllCmd}"
                                CommandParameter="{StaticResource FalseValue}"
                                ToolTip="All Layers OFF">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_allOFF1.png"/>
                                </Button.Content>
                            </Button>

                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                Style="{DynamicResource ReliefButton}"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=SaveVisibilityStateCmd}"
                                ToolTip="Save Layer State">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_allVIS_SAVE.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                Style="{DynamicResource ReliefButton}"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=RestoreVisibilityStateCmd}"
                                ToolTip="Restore Saved Layer State">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_allVIS_RESTORE.png"/>
                                </Button.Content>
                            </Button>
                        </StackPanel>

                        <!-- General Geometry and Polygon Edit Controls-->
                        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="5,0,0,5"
                                    IsEnabled="{Binding ElementName=MainView, Path=LoggedUser, Mode=OneWay, Converter={StaticResource UserRoleToBooleanConverter}, ConverterParameter=ALL_RIGHTS+DRAWING_RIGHTS+ZONING_RIGHTS}">
                            <Button HorizontalAlignment="Left" Height="26" Width="26"
                                Style="{DynamicResource ReliefButton}"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=DeleteSelectedEntityCmd, Mode=OneWay}"
                                CommandParameter="GeometryViewer.EntityGeometry.ZonedPolygon+GeometryViewer.EntityGeometry.ZonedVolume"
                                ToolTip="Delete Geometry">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_allgDEL1.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                Style="{DynamicResource ReliefButton}"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchAllOffButSelectedCmd}"
                                ToolTip="Turn All Off Except Selected">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_allOFFexceptME.png"/>
                                </Button.Content>
                            </Button>
                            <ToggleButton x:Name="tg_zgd_PolygonEdit" HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                Style="{DynamicResource ToggleButtonLight}"                       
                                IsChecked="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Mode=OneWay, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=POLYGON_VERTEX}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchZoneEditModeCmd}"
                                CommandParameter="POLYGON_VERTEX"
                                ToolTip="Toggle Polygon Edit Mode">
                                <ToggleButton.Content>
                                    <Image Source="./Data/Icons/switch_allPE.png"/>
                                </ToggleButton.Content>
                                <ToggleButton.IsEnabled>
                                    <MultiBinding Converter="{StaticResource BoolAndConverter}" ConverterParameter="{StaticResource FalseValue}" UpdateSourceTrigger="PropertyChanged" Mode="OneWay">
                                        <Binding ElementName="zoneGroupDisplay" Path="SelectedEntityIsPolygon" Mode="OneWay"/>
                                        <Binding ElementName="zoneGroupDisplay" Path="ZoneEditMode" Converter="{StaticResource ZoneEditTypeToBooleanConverter}" ConverterParameter="NO_EDIT+POLYGON_VERTEX" Mode="OneWay"/>
                                    </MultiBinding>
                                </ToggleButton.IsEnabled>
                            </ToggleButton>
                            <ToggleButton x:Name="tg_zgd_OpeningEdit" HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                      Style="{DynamicResource ToggleButtonLight}"  
                                      IsChecked="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Mode=OneWay, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=POLYGON_OPENING}"
                                      Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchZoneEditModeCmd}"
                                      CommandParameter="POLYGON_OPENING"
                                      ToolTip="Toggle Polygon Openings Edit Mode">
                                <ToggleButton.Content>
                                    <Image Source="./Data/Icons/switch_allOE.png"/>
                                </ToggleButton.Content>
                                <ToggleButton.IsEnabled>
                                    <MultiBinding Converter="{StaticResource BoolAndConverter}" ConverterParameter="{StaticResource FalseValue}" UpdateSourceTrigger="PropertyChanged" Mode="OneWay">
                                        <Binding ElementName="zoneGroupDisplay" Path="SelectedEntityIsPolygon" Mode="OneWay"/>
                                        <Binding ElementName="zoneGroupDisplay" Path="ZoneEditMode" Converter="{StaticResource ZoneEditTypeToBooleanConverter}" ConverterParameter="NO_EDIT+POLYGON_OPENING" Mode="OneWay"/>
                                    </MultiBinding>
                                </ToggleButton.IsEnabled>
                            </ToggleButton>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                Style="{StaticResource ReliefButton}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=BatchSetPolygonLabelsCmd, Mode=OneWay}"
                                CommandParameter="{Binding ElementName=txtb_pg_all_labels, Path=Text, Mode=OneWay}"
                                ToolTip="Batch Edit Polygon Labels">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_allZEDIT.png"/>
                                </Button.Content>
                            </Button>
                            <ToggleButton HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                      Style="{StaticResource ToggleButtonLight}"
                                      IsChecked="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Mode=OneWay, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=POLYGON_SPLIT}"
                                      Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchZoneEditModeCmd}"
                                      CommandParameter="POLYGON_SPLIT"
                                      ToolTip="Toggle Polygon Split Mode">
                                <ToggleButton.Content>
                                    <Image Source="./Data/Icons/switch_polygonSplit.png"/>
                                </ToggleButton.Content>
                                <ToggleButton.IsEnabled>
                                    <MultiBinding Converter="{StaticResource BoolAndConverter}" ConverterParameter="{StaticResource FalseValue}" UpdateSourceTrigger="PropertyChanged" Mode="OneWay">
                                        <Binding ElementName="zoneGroupDisplay" Path="SelectedEntityIsPolygon" Mode="OneWay"/>
                                        <Binding ElementName="zoneGroupDisplay" Path="ZoneEditMode" Converter="{StaticResource ZoneEditTypeToBooleanConverter}" ConverterParameter="NO_EDIT+POLYGON_SPLIT" Mode="OneWay"/>
                                    </MultiBinding>
                                </ToggleButton.IsEnabled>
                            </ToggleButton>
                        </StackPanel>
                        

                        <!-- MANAGE OPACITY, CREATE AND EDIT VOLUMES -->
                        <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="5,0,0,5"
                                    IsEnabled="{Binding ElementName=MainView, Path=LoggedUser, Mode=OneWay, Converter={StaticResource UserRoleToBooleanConverter}, ConverterParameter=ALL_RIGHTS+DRAWING_RIGHTS+ZONING_RIGHTS}">
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="5,0,0,5"
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchOpacityGradientVolumeCmd}"
                                CommandParameter="{StaticResource TrueValue}"
                                ToolTip="Lower Opacity of All but Selected Volume">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_volOPAC.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchOpacityGradientVolumeCmd}"
                                CommandParameter="{StaticResource FalseValue}"
                                ToolTip="Restore Opacity of All Volumes">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_volOPAC_RESTORE.png"/>
                                </Button.Content>
                            </Button>

                            <Button HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=SelectedEntityIsPolygon, Mode=OneWay}"
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=CreateZonedVolumeByExtrusionCmd}"
                                ToolTip="Extrude Polygon To Volume">
                                <Button.Content>
                                    <Image Source="./Data/Icons/switch_volEXTRUDE.png"/>
                                </Button.Content>
                            </Button>
                            <ToggleButton HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                      Style="{DynamicResource ToggleButtonLight}"
                                      IsChecked="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Mode=OneWay, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=VOLUME_CREATE}"
                                      Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchZoneEditModeCmd}"
                                      CommandParameter="VOLUME_CREATE"
                                      ToolTip="Create Volume out of 2 or more Polygons">
                                <ToggleButton.Content>
                                    <Image Source="./Data/Icons/switch_volRULED.png"/>
                                </ToggleButton.Content>
                                <ToggleButton.IsEnabled>
                                    <MultiBinding Converter="{StaticResource BoolAndConverter}" ConverterParameter="{StaticResource FalseValue}" UpdateSourceTrigger="PropertyChanged" Mode="OneWay">
                                        <Binding ElementName="zoneGroupDisplay" Path="SelectedEntityIsPolygon" Mode="OneWay"/>
                                        <Binding ElementName="zoneGroupDisplay" Path="ZoneEditMode" Converter="{StaticResource ZoneEditTypeToBooleanConverter}" ConverterParameter="NO_EDIT+VOLUME_CREATE" Mode="OneWay"/>
                                    </MultiBinding>
                                </ToggleButton.IsEnabled>
                            </ToggleButton>
                            <ToggleButton x:Name="tg_zgd_VolumeCreate" HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                      Style="{DynamicResource ToggleButtonLight}"
                                      IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT+VOLUME_CREATE_COMPLEX, Mode=OneWay}"
                                      IsChecked="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Mode=OneWay, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=VOLUME_CREATE_COMPLEX}"
                                      Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchZoneEditModeCmd}"
                                      CommandParameter="VOLUME_CREATE_COMPLEX"
                                      ToolTip="Create Volume out of 2 or more Levels">
                                <ToggleButton.Content>
                                    <Image Source="./Data/Icons/switch_volCOMPLEX.png"/>
                                </ToggleButton.Content>
                            </ToggleButton>

                            <ToggleButton x:Name="tg_zgd_VolumeBTEdit" HorizontalAlignment="Left" Height="26" Width="26" Margin="2,0,0,0"
                                      Style="{DynamicResource ToggleButtonLight}"
                                      IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT+VOLUME_SURFACE, Mode=OneWay}"
                                      IsChecked="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Mode=OneWay, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=VOLUME_SURFACE}"
                                      Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchZoneEditModeCmd}"
                                      CommandParameter="VOLUME_SURFACE"
                                      ToolTip="Edit Volume Components">
                                <ToggleButton.Content>
                                    <Image Source="./Data/Icons/switch_volBTAssign.png"/>
                                </ToggleButton.Content>
                            </ToggleButton>
                        </StackPanel>                        
                        

                        <!-- LIST OF GEOMETRIC ENTITIES -->
                        <TreeView Grid.Row="5" x:Name="tv_Polygons" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                                  Margin="5,0" MinWidth="185" Width="Auto" Height="Auto"
                                  IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT, Mode=OneWay}"
                                  ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                                  ScrollViewer.VerticalScrollBarVisibility="Visible"
                                  ItemsSource="{Binding ElementName=zoneGroupDisplay, Path=ZoneLayers, Mode=TwoWay, Converter={StaticResource TreeViewSortingEntityConverter}, ConverterParameter=EntityName}" 
                                  ItemTemplate="{DynamicResource ZoneInList}"
                                  ItemContainerStyle="{DynamicResource TreeItemForLayers}"
                                  >
                            <i:Interaction.Behaviors>
                                <!-- the SelectedItem Property is READONLY -->
                                <gvxuie:BindableSelectedItemBehavior SelectedItem="{Binding ElementName=zoneGroupDisplay, Path=SelectedEntity, Mode=TwoWay}"/>
                            </i:Interaction.Behaviors>
                            <TreeView.InputBindings>
                                <KeyBinding Key="Delete" Command="{Binding ElementName=zoneGroupDisplay, Path=DeleteSelectedEntityCmd, Mode=OneWay}"/>
                            </TreeView.InputBindings>
                        </TreeView>
                        <GridSplitter Grid.Row="6" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="5,0" Height="3" ResizeDirection="Rows"
                                       Background="{DynamicResource {x:Static SystemColors.MenuBarBrushKey}}" 
                                       BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkDarkBrushKey}}"
                                       BorderThickness="1"/>
                        <TextBlock Grid.Row="7" HorizontalAlignment="Stretch" Height="25" Margin="5,5,5,0" 
                                   TextAlignment="Left"
                                   Padding="0,0,2,0"
                                   Text="{Binding ElementName=tv_Polygons, Path=SelectedItem.EntityName, StringFormat=Selected: \{0\}}"
                                   FontWeight="Bold"/>
                        
                        <DockPanel Grid.Row="8" LastChildFill="True" Margin="5,0,5,5"
                                   IsEnabled="{Binding ElementName=MainView, Path=LoggedUser, Mode=OneWay, Converter={StaticResource UserRoleToBooleanConverter}, ConverterParameter=ALL_RIGHTS+DRAWING_RIGHTS+ZONING_RIGHTS}">
                            <TextBlock HorizontalAlignment="Left" Height="20" Width="40" Text="Name: " DockPanel.Dock="Left"/>
                            <TextBox HorizontalAlignment="Stretch" Height="25" Width="Auto"
                                 IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT, Mode=OneWay}"
                                 Style="{DynamicResource CoordinateInput}" 
                                 Text="{Binding ElementName=zoneGroupDisplay, Path=SelectedEntity.EntityName, Mode=TwoWay}"/>
                        </DockPanel>
                        
                        <DockPanel Grid.Row="9" LastChildFill="True" Margin="5,0,5,5"
                                   IsEnabled="{Binding ElementName=MainView, Path=LoggedUser, Mode=OneWay, Converter={StaticResource UserRoleToBooleanConverter}, ConverterParameter=ALL_RIGHTS+DRAWING_RIGHTS+ZONING_RIGHTS}">
                            <TextBlock HorizontalAlignment="Left" Height="22" Width="40" Text="Layer: " DockPanel.Dock="Left"/>
                            <ComboBox HorizontalAlignment="Stretch" Height="25" 
                                  IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT, Mode=OneWay}"
                                  ItemsSource="{Binding ElementName=zoneGroupDisplay, Path=ZoneLayersFlat}"
                                  ItemTemplate="{DynamicResource ZoneInComboBox}"
                                  SelectedItem="{Binding ElementName=zoneGroupDisplay, Path=LayerOfSelectedEntity, Mode=TwoWay}"/>
                        </DockPanel>
                        
                        <DockPanel Grid.Row="10" LastChildFill="True" Margin="5,0,5,5"
                                   IsEnabled="{Binding ElementName=MainView, Path=LoggedUser, Mode=OneWay, Converter={StaticResource UserRoleToBooleanConverter}, ConverterParameter=ALL_RIGHTS+DRAWING_RIGHTS+ZONING_RIGHTS}">
                            <TextBlock HorizontalAlignment="Left" Height="25" Width="40" Text="Height: " DockPanel.Dock="Left"/>
                            <TextBox HorizontalAlignment="Stretch" Height="25" Width="Auto"
                                 Visibility="{Binding ElementName=zoneGroupDisplay, Path=SelectedEntityIsPolygon, Converter={StaticResource BoolToVisConverter}, Mode=OneWay}"
                                 IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT, Mode=OneWay}"
                                 Style="{DynamicResource CoordinateInput}" 
                                 Text="{Binding ElementName=zoneGroupDisplay, Path=SelectedPolygonHeight, Mode=TwoWay, Converter={StaticResource DoubleStringToStringConverter}, ConverterParameter=F2}"/>
                        </DockPanel>

                        <DockPanel Grid.Row="11" LastChildFill="True" Margin="5,0,5,5"
                                   IsEnabled="{Binding ElementName=MainView, Path=LoggedUser, Mode=OneWay, Converter={StaticResource UserRoleToBooleanConverter}, ConverterParameter=ALL_RIGHTS+DRAWING_RIGHTS+ZONING_RIGHTS}">
                            <TextBlock HorizontalAlignment="Left" Height="25" Width="40" Text="Labels: " DockPanel.Dock="Left"/>
                            <TextBox x:Name="txtb_pg_all_labels" HorizontalAlignment="Stretch" Height="25" Width="Auto"
                                 IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT, Mode=OneWay}"
                                 Style="{DynamicResource CoordinateInput}" 
                                 Text="{Binding ElementName=zoneGroupDisplay, Path=LabelsOfSelectedPolygon, Mode=OneWay}"/>
                        </DockPanel>

                        
                        <TextBlock Grid.Row="12" HorizontalAlignment="Left" Margin="5,5,0,0" Height="20" Width="40"
                                   TextAlignment="Left" Padding="0,0,2,0" FontWeight="Bold"
                                   Text="Search"/>
                        <TextBox Grid.Row="12" HorizontalAlignment="Stretch" Height="25" Width="Auto" Margin="45,5,47,0"
                                 x:Name="txt_zgd_search_text"
                                 IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT, Mode=OneWay}"
                                 Style="{DynamicResource CoordinateInput}"
                                 Text="{Binding ElementName=zoneGroupDisplay, Path=SearchText, Mode=OneWayToSource}"/>
                        <Button Grid.Row="12" HorizontalAlignment="Right" Height="25" Width="40" Margin="0,5,5,0"
                                Content="Find"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT, Mode=OneWay}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=SearchByNameCmd, Mode=OneWay}"
                                CommandParameter="{Binding ElementName=txt_zgd_search_text, Path=Text, Mode=OneWay}"
                                Style="{DynamicResource ReliefButton}"/>
                        
                        <!-- trinagulation debugging -->
                        <TextBlock Grid.Row="13" HorizontalAlignment="Left" Margin="5,2,0,0" Height="16" Width="Auto"
                                   TextAlignment="Left" Padding="0,0,2,0" Foreground="DimGray"
                                   Text="Triangulation step-by-step"/>
                        <ToggleButton Grid.Row="14" HorizontalAlignment="Left" Margin="5,5,0,0" Height="26" Width="26"
                                      Style="{StaticResource ToggleButtonLight}"
                                      ToolTip="Select polygons for triangulation"
                                      IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=ZoneEditMode, Converter={StaticResource ZoneEditTypeToBooleanConverter}, ConverterParameter=NO_EDIT, Mode=OneWay}"
                                      IsChecked="{Binding ElementName=triangDisplay, Path=IsPickingPolygons, Mode=TwoWay}">
                            <ToggleButton.Content>
                                <Image Source="./Data/Icons/triangulation_1.png"/>
                            </ToggleButton.Content>
                        </ToggleButton>
                        <StackPanel Grid.Row="14" Margin="33,5,5,0" Orientation="Horizontal"
                                    IsEnabled="{Binding ElementName=triangDisplay, Path=CanTestTriangulation, Mode=OneWay}">
                            <Button Height="26" Width="26" Margin="0,0,2,0" Style="{StaticResource ReliefButton}"
                                    ToolTip="Find connections across the holes STEP by STEP"
                                    Command="{Binding ElementName=triangDisplay, Path=TestPathFindingForSplitCmd,Mode=OneWay}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/triangulation_1x2.png"/>
                                </Button.Content>
                            </Button>
                            <Button Height="26" Width="26" Margin="0,0,2,0" Style="{StaticResource ReliefButton}"
                                    ToolTip="Find splitting paths STEP by STEP"
                                    Command="{Binding ElementName=triangDisplay, Path=TestPathFindingForSplit2Cmd, Mode=OneWay}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/triangulation_1x3.png"/>
                                </Button.Content>
                            </Button>
                            <Button Height="26" Width="26" Margin="0,0,2,0" Style="{StaticResource ReliefButton}"
                                    ToolTip="Split along hole(s) into non-monotonous polygons"
                                    Command="{Binding ElementName=triangDisplay, Path=SetTriangulationStageSplitAlongHolesCmd,Mode=OneWay}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/triangulation_2.png"/>
                                </Button.Content>
                            </Button>
                            <Button Height="26" Width="26" Margin="0,0,2,0" Style="{StaticResource ReliefButton}"
                                    ToolTip="Split non-monotonous polygons into monotonous ones"
                                    Command="{Binding ElementName=triangDisplay, Path=SetTriangulationStageSplitIntoMonotoneCmd, Mode=OneWay}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/triangulation_3.png"/>
                                </Button.Content>
                            </Button>
                            <Button Height="26" Width="26" Margin="0,0,2,0" Style="{StaticResource ReliefButton}"
                                    ToolTip="Triangulate the monotonous polygons"
                                    Command="{Binding ElementName=triangDisplay, Path=SetTriangulationStageTriangulateMonotoneCmd, Mode=OneWay}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/triangulation_4.png"/>
                                </Button.Content>
                            </Button>
                            <TextBox Width="30"  Margin="0,2,2,0" Style="{StaticResource CoordinateInput}" ToolTip="Index of polygon to inspect"
                                     Text="{Binding ElementName=triangDisplay, Path=PolygonIndexToInspect, Mode=TwoWay}"/>
                            <Button Height="26" Width="26" Margin="0,0,2,0" Style="{StaticResource ReliefButton_Important}"
                                    ToolTip="Show final result"
                                    Command="{Binding ElementName=triangDisplay, Path=SetTriangulationStageShowResultCmd, Mode=OneWay}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/triangulation_5.png"/>
                                </Button.Content>
                            </Button>
                            <Button Height="26" Width="26" Margin="0,0,2,0" Style="{StaticResource ReliefButton}"
                                    ToolTip="Reset"
                                    Command="{Binding ElementName=triangDisplay, Path=ResetAllCmd, Mode=OneWay}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/a_refresh.png"/>
                                </Button.Content>
                            </Button>
                        </StackPanel>
                        <StackPanel Grid.Row="15" Margin="33,5,5,0" Orientation="Horizontal"
                                    IsEnabled="{Binding ElementName=triangDisplay, Path=CanTestTriangulation, Mode=OneWay}">
                            <TextBlock Margin="0,0,2,0" Width="26" Height="16" ToolTip="Connection finding step" TextAlignment="Center"
                                       Text="{Binding ElementName=triangDisplay, Path=TestPathFindingStepNr, Mode=OneWay}"
                                       FontWeight="Bold" Foreground="DimGray"/>
                            <TextBlock Margin="0,0,2,0" Width="26" Height="16" ToolTip="Path finding step" TextAlignment="Center"
                                       Text="{Binding ElementName=triangDisplay, Path=TestPathFindingStepNr2, Mode=OneWay}"
                                       FontWeight="Bold" Foreground="DimGray"/>
                        </StackPanel>
                        
                    </Grid>
                </Expander>
                <Expander Header="Edit Selected Polygon" 
                          Style="{DynamicResource ViewportExpander}"
                          IsExpanded="{Binding ElementName=tg_zgd_PolygonEdit, Path=IsChecked, Mode=OneWay}"
                          Visibility="{Binding ElementName=tg_zgd_PolygonEdit, Path=IsChecked, Converter={StaticResource BoolToVisConverter}, Mode=OneWay}"
                          >
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="5"/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="Auto" MinHeight="100" MaxHeight="250"/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="5"/>
                        </Grid.RowDefinitions>
                        <Label Grid.Row="1" HorizontalAlignment="Left" Width="190" Height="30" Margin="5,0,0,5" 
                               Padding="1" HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch" 
                               Content="{Binding ElementName=zoneGroupDisplay, Path=SelectedEntity, Mode=OneWay}"
                               ContentTemplate="{DynamicResource WindingDeirectionLabel}"
                               />
                        <ToggleButton Grid.Row="2" HorizontalAlignment="Left" Height="26" Width="26" Margin="5,0,0,5" 
                                      x:Name="tg_zgd_pe_EditCtrlPoints"
                                      IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=PolygonEditModeType, Mode=OneWay, Converter={StaticResource PolygonEditModeTypeToBooleanConverter}, ConverterParameter=NONE+VERTEX_EDIT}"
                                      IsChecked="{Binding ElementName=zoneGroupDisplay, Path=PolygonEditModeType, Mode=OneWay, Converter={StaticResource PolygonEditModeTypeToBooleanConverter}, ConverterParameter=VERTEX_EDIT}"
                                      Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchPolygonEditModeTypeCmd, Mode=OneWay}"
                                      CommandParameter="VERTEX_EDIT"
                                      Style="{DynamicResource ToggleButtonLight}"                                
                                      ToolTip="Edit Polygon Control Points">
                            <ToggleButton.Content>
                                <Image Source="./Data/Icons/switch_allPEMOVE.png"/>
                            </ToggleButton.Content>
                        </ToggleButton>
                        <ToggleButton Grid.Row="2" HorizontalAlignment="Left" Height="26" Width="26" Margin="33,0,0,5" 
                                Style="{DynamicResource ToggleButtonLight}"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=PolygonEditModeType, Mode=OneWay, Converter={StaticResource PolygonEditModeTypeToBooleanConverter}, ConverterParameter=NONE+VERTEX_ADD}"
                                IsChecked="{Binding ElementName=zoneGroupDisplay, Path=PolygonEditModeType, Mode=OneWay, Converter={StaticResource PolygonEditModeTypeToBooleanConverter}, ConverterParameter=VERTEX_ADD}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchPolygonEditModeTypeCmd, Mode=OneWay}"
                                CommandParameter="VERTEX_ADD"
                                ToolTip="Add Control Point to Polygon">
                            <ToggleButton.Content>
                                <Image Source="./Data/Icons/switch_allADDP.png"/>
                            </ToggleButton.Content>
                        </ToggleButton>
                        <Button Grid.Row="2" HorizontalAlignment="Left" Height="26" Width="26" Margin="61,0,0,5" 
                                Style="{DynamicResource ReliefButton}"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=PolygonEditModeType, Mode=OneWay, Converter={StaticResource PolygonEditModeTypeToBooleanConverter}, ConverterParameter=NONE+VERTEX_REMOVE}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=DeleteVertexCmd, Mode=OneWay}"      
                                ToolTip="Remove Control Point from Polygon">
                            <Button.Content>
                                <Image Source="./Data/Icons/switch_allDELP.png"/>
                            </Button.Content>
                        </Button>
                        <Button Grid.Row="2" HorizontalAlignment="Left" Height="26" Width="26" Margin="89,0,0,5"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=PolygonEditModeType, Mode=OneWay, Converter={StaticResource PolygonEditModeTypeToBooleanConverter}, ConverterParameter=NONE+POLY_REVERSE}"
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=ReversePolygonCmd, Mode=OneWay}"
                                ToolTip="Reverse Direction of Polygon">
                            <Button.Content>
                                <Image Source="./Data/Icons/switch_allREVERSE.png"/>
                            </Button.Content>
                        </Button>
                        
                        
                        
                        <ToggleButton Grid.Row="2" HorizontalAlignment="Left" Height="26" Width="26" Margin="117,0,0,5"
                                      IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=PolygonEditModeType, Mode=OneWay, Converter={StaticResource PolygonEditModeTypeToBooleanConverter}, ConverterParameter=NONE+POLY_LABELS_EDIT}"
                                      IsChecked="{Binding ElementName=zoneGroupDisplay, Path=PolygonEditModeType, Mode=OneWay, Converter={StaticResource PolygonEditModeTypeToBooleanConverter}, ConverterParameter=POLY_LABELS_EDIT}"
                                      Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchPolygonEditModeTypeCmd, Mode=OneWay}"
                                      CommandParameter="POLY_LABELS_EDIT"
                                      Style="{DynamicResource ToggleButtonLight}"
                                      ToolTip="Edit Polygon Labels">
                            <ToggleButton.Content>
                                <Image Source="./Data/Icons/switch_allZEDIT.png"/>
                            </ToggleButton.Content>
                        </ToggleButton>
                        <Button Grid.Row="2" HorizontalAlignment="Left" Height="26" Width="26" Margin="145,0,0,5"
                                Style="{DynamicResource ReliefButton}"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=PolygonEditModeType, Mode=OneWay, Converter={StaticResource PolygonEditModeTypeToBooleanConverter}, ConverterParameter=NONE+POLY_LABELS_DEFAULT}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=ResetPolygonLabelsCmd, Mode=OneWay}"
                                ToolTip="Restore Default Labels">
                            <Button.Content>
                                <Image Source="./Data/Icons/switch_allZDEFAULT.png"/>
                            </Button.Content>
                        </Button>
                        
                        <TreeView Grid.Row="4" x:Name="tv_PolygonVertices"  HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                                  Margin="5,0" MinWidth="185" Width="Auto" Height="Auto"
                                  ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                                  ScrollViewer.VerticalScrollBarVisibility="Visible"
                                  ItemsSource="{Binding ElementName=zoneGroupDisplay, Path=ZonePolygonVertices, Mode=TwoWay}"
                                  ItemTemplate="{StaticResource PolygonVertexInList}"
                                  ItemContainerStyle="{DynamicResource TreeItemForLayers}">
                            <i:Interaction.Behaviors>
                                <!-- the SelectedItem Property is READONLY -->
                                <gvxuie:BindableSelectedItemBehavior SelectedItem="{Binding ElementName=zoneGroupDisplay, Path=SelectedVertex, Mode=TwoWay}"/>
                            </i:Interaction.Behaviors>
                        </TreeView>

                        <GridSplitter Grid.Row="5" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="5,0" Height="3" ResizeDirection="Rows"
                                       Background="{DynamicResource {x:Static SystemColors.MenuBarBrushKey}}" 
                                       BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkDarkBrushKey}}"
                                       BorderThickness="1"/>

                        <TextBlock Grid.Row="6" HorizontalAlignment="Left" Margin="5,4,0,0" Width="150" Height="20" Text="{Binding ElementName=zoneGroupDisplay, Path=SelectedVertex.EntityName}" TextAlignment="Left"/>
                        
                        <StackPanel Grid.Row="7" Visibility="{Binding ElementName=tg_zgd_pe_EditCtrlPoints, Path=IsChecked, Converter={StaticResource BoolToVisConverter}, Mode=OneWay}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>                               
                                <TextBlock Grid.Row="0" HorizontalAlignment="Left" Margin="5,4,0,0" Width="65" Height="20" Text="To Next:" TextAlignment="Left"/>
                                <Slider Grid.Row="0" x:Name="sl_vetFWMove" HorizontalAlignment="Stretch" Margin="74,4,0,0" Width="Auto" TickPlacement="BottomRight" 
                                Maximum="{Binding ElementName=zoneGroupDisplay, Path=SelectedVertex.MaxMoveDistForward}" Minimum="0" Cursor="Hand" 
                                Value="{Binding ElementName=zoneGroupDisplay, Path=PolygonVertexFwDist, Mode=TwoWay}" 
                                Style="{DynamicResource SliderStyleOrange}"/>
                                <TextBlock Grid.Row="1" HorizontalAlignment="Left" Width="30" Height="20" Margin="70,4,0,0"
                                   Text="{Binding ElementName=sl_vetFWMove, Path=Minimum, StringFormat=[\{0:0.00\}]}"/>
                                <TextBlock Grid.Row="1" HorizontalAlignment="Right" Width="40" Height="20" Margin="0,4,5,0"
                                   Text="{Binding ElementName=sl_vetFWMove, Path=Maximum, StringFormat=[\{0:0.00\}]}"/>

                                <TextBlock Grid.Row="2" HorizontalAlignment="Left" Margin="5,4,0,0" Width="65" Height="20" Text="To Previous:" TextAlignment="Left"/>
                                <Slider Grid.Row="2" x:Name="sl_vetBWMove" HorizontalAlignment="Stretch" Margin="74,4,0,0" Width="Auto" TickPlacement="BottomRight" 
                                Maximum="{Binding ElementName=zoneGroupDisplay, Path=SelectedVertex.MaxMoveDistBackward}" Minimum="0" Cursor="Hand" 
                                Value="{Binding ElementName=zoneGroupDisplay, Path=PolygonVertexBwDist, Mode=TwoWay}" 
                                Style="{DynamicResource SliderStyleOrange}"/>
                                <TextBlock Grid.Row="3" HorizontalAlignment="Left" Width="30" Height="20" Margin="70,4,0,0"
                                   Text="{Binding ElementName=sl_vetBWMove, Path=Minimum, StringFormat=[\{0:0.00\}]}"/>
                                <TextBlock Grid.Row="3" HorizontalAlignment="Right" Width="40" Height="20" Margin="0,4,5,0"
                                   Text="{Binding ElementName=sl_vetBWMove, Path=Maximum, StringFormat=[\{0:0.00\}]}"/>
                            </Grid>
                        </StackPanel>
                        

                    </Grid>
                </Expander>
                <Expander Header="Edit Polygon Openings" 
                          Style="{DynamicResource ViewportExpander}"
                          IsExpanded="{Binding ElementName=tg_zgd_OpeningEdit, Path=IsChecked, Mode=OneWay}"
                          Visibility="{Binding ElementName=tg_zgd_OpeningEdit, Path=IsChecked, Converter={StaticResource BoolToVisConverter}, Mode=OneWay}"
                          >
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="5"/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="Auto" MinHeight="100" MaxHeight="250"/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="5"/>
                        </Grid.RowDefinitions>
                        <ToggleButton Grid.Row="1" HorizontalAlignment="Left" Height="26" Width="26" Margin="5,0,0,5" 
                                      IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=PolygonEditModeType, Mode=OneWay, Converter={StaticResource PolygonEditModeTypeToBooleanConverter}, ConverterParameter=NONE+OPENING_EDIT}"
                                      IsChecked="{Binding ElementName=zoneGroupDisplay, Path=PolygonEditModeType, Mode=OneWay, Converter={StaticResource PolygonEditModeTypeToBooleanConverter}, ConverterParameter=OPENING_EDIT}"
                                      Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchPolygonEditModeTypeCmd, Mode=OneWay}"
                                      CommandParameter="OPENING_EDIT"
                                      Style="{DynamicResource ToggleButtonLight}"                                
                                      ToolTip="Edit Polygon Opening">
                            <ToggleButton.Content>
                                <Image Source="./Data/Icons/switch_allOPEDIT.png"/>
                            </ToggleButton.Content>
                        </ToggleButton>
                        <ToggleButton Grid.Row="1" HorizontalAlignment="Left" Height="26" Width="26" Margin="33,0,0,5" 
                                      IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=PolygonEditModeType, Mode=OneWay, Converter={StaticResource PolygonEditModeTypeToBooleanConverter}, ConverterParameter=NONE+OPENING_ADD}"
                                      IsChecked="{Binding ElementName=zoneGroupDisplay, Path=PolygonEditModeType, Mode=OneWay, Converter={StaticResource PolygonEditModeTypeToBooleanConverter}, ConverterParameter=OPENING_ADD}"
                                      Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchPolygonEditModeTypeCmd, Mode=OneWay}"
                                      CommandParameter="OPENING_ADD"
                                      Style="{DynamicResource ToggleButtonLight}"                                
                                      ToolTip="Add Opening to Polygon">
                            <ToggleButton.Content>
                                <Image Source="./Data/Icons/switch_allOPADD.png"/>
                            </ToggleButton.Content>
                        </ToggleButton>
                        <Button Grid.Row="1" HorizontalAlignment="Left" Height="26" Width="26" Margin="61,0,0,5" 
                                      IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=PolygonEditModeType, Mode=OneWay, Converter={StaticResource PolygonEditModeTypeToBooleanConverter}, ConverterParameter=NONE+OPENING_REMOVE}"
                                      Command="{Binding ElementName=zoneGroupDisplay, Path=DeleteOpeningCmd, Mode=OneWay}"  
                                      Style="{DynamicResource ReliefButton}"                                
                                      ToolTip="REmove Opening from Polygon">
                            <Button.Content>
                                <Image Source="./Data/Icons/switch_allOPDEL.png"/>
                            </Button.Content>
                        </Button>

                        <TreeView Grid.Row="4" x:Name="tv_PolygonOpenings"  HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                                  Margin="5,0" MinWidth="185" Width="Auto" Height="Auto"
                                  ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                                  ScrollViewer.VerticalScrollBarVisibility="Visible"
                                  ItemsSource="{Binding ElementName=zoneGroupDisplay, Path=ZonePolygonOpenings, Mode=TwoWay}"
                                  ItemTemplate="{StaticResource PolygonOpeningInList}"
                                  ItemContainerStyle="{DynamicResource TreeItemForLayers}"
                                  >
                            <i:Interaction.Behaviors>
                                 <!--the SelectedItem Property is READONLY--> 
                                <gvxuie:BindableSelectedItemBehavior SelectedItem="{Binding ElementName=zoneGroupDisplay, Path=SelectedOpening, Mode=TwoWay}"/>
                            </i:Interaction.Behaviors>
                        </TreeView>

                        <GridSplitter Grid.Row="5" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="5,0" Height="3" ResizeDirection="Rows"
                                       Background="{DynamicResource {x:Static SystemColors.MenuBarBrushKey}}" 
                                       BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkDarkBrushKey}}"
                                       BorderThickness="1"/>
                        
                        <TextBlock Grid.Row="6" HorizontalAlignment="Left" Margin="5,4,0,0" Width="150" Height="20" Text="{Binding ElementName=zoneGroupDisplay, Path=SelectedOpening.EntityName}" TextAlignment="Left"/>


                    </Grid>
                </Expander>
                <Expander Header="Create Volume"
                          Style="{DynamicResource ViewportExpander}"
                          IsExpanded="{Binding ElementName=tg_zgd_VolumeCreate, Path=IsChecked, Mode=OneWay}"
                          Visibility="{Binding ElementName=tg_zgd_VolumeCreate, Path=IsChecked, Converter={StaticResource BoolToVisConverter}, Mode=OneWay}"
                          >
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="5"/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="Auto" MinHeight="60" MaxHeight="250"/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="5"/>
                        </Grid.RowDefinitions>

                        <ToggleButton Grid.Row="1" HorizontalAlignment="Left" Height="26" Width="26" Margin="5,0,0,5"
                                      IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=VolumeEditModeType, Mode=OneWay, Converter={StaticResource VolumeEditModeTypeToBooleanConverter}, ConverterParameter=NONE+LEVEL_ADD}"
                                      IsChecked="{Binding ElementName=zoneGroupDisplay, Path=VolumeEditModeType, Mode=OneWay, Converter={StaticResource VolumeEditModeTypeToBooleanConverter}, ConverterParameter=LEVEL_ADD}"
                                      Command="{Binding ElementName=zoneGroupDisplay, Path=SwitchVolumeEditModeTypeCmd, Mode=OneWay}"
                                      CommandParameter="LEVEL_ADD"
                                      Style="{DynamicResource ToggleButtonLight}"
                                      ToolTip="Press to Begin Defining a Level">
                            <ToggleButton.Content>
                                <Image Source="./Data/Icons/switch_volLEVEL_ADD.png"/>
                            </ToggleButton.Content>
                        </ToggleButton>

                        <Button Grid.Row="1" HorizontalAlignment="Left" Height="26" Width="26" Margin="33,0,0,5"
                                IsEnabled="{Binding ElementName=zoneGroupDisplay, Path=VolumeEditModeType, Mode=OneWay, Converter={StaticResource VolumeEditModeTypeToBooleanConverter}, ConverterParameter=NONE+LEVEL_DELETE}"
                                Command="{Binding ElementName=zoneGroupDisplay, Path=DeleteVolumeLevelCmd, Mode=OneWay}"
                                Style="{DynamicResource ReliefButton}"
                                ToolTip="Remove Selected Level">
                            <Button.Content>
                                <Image Source="./Data/Icons/switch_volLEVEL_DEL.png"/>
                            </Button.Content>
                        </Button>

                        <TextBlock Grid.Row="3" HorizontalAlignment="Left" Margin="5,4,0,0" Width="150" Height="20" Text="Volume Levels:" TextAlignment="Left"/>

                        <TreeView Grid.Row="4" x:Name="tv_volumeLevels" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                                  Margin="5,0" MinWidth="185" Width="Auto" Height="Auto"
                                  ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                                  ScrollViewer.VerticalScrollBarVisibility="Visible"
                                  ItemsSource="{Binding ElementName=zoneGroupDisplay, Path=ZonedVolumeLevels, Mode=TwoWay}" 
                                  ItemTemplate="{DynamicResource VolumeLevelInList}"
                                  ItemContainerStyle="{DynamicResource LayerListStyleVolCreation}">
                            <i:Interaction.Behaviors>
                                <!-- the SelectedItem Property is READONLY -->
                                <gvxuie:BindableSelectedItemBehavior SelectedItem="{Binding ElementName=zoneGroupDisplay, Path=SelectedVolumeLevel, Mode=TwoWay}"/>
                            </i:Interaction.Behaviors>
                        </TreeView>
                        <GridSplitter Grid.Row="5" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="5,0" Height="3" ResizeDirection="Rows"
                                       Background="{DynamicResource {x:Static SystemColors.MenuBarBrushKey}}" 
                                       BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkDarkBrushKey}}"
                                       BorderThickness="1"/>
                        <TextBlock Grid.Row="6" HorizontalAlignment="Stretch" Height="25" Margin="5,5,5,0" 
                                   TextAlignment="Left"
                                   Padding="0,0,2,0"
                                   Text="{Binding ElementName=tv_volumeLevels, Path=SelectedItem.EntityName, StringFormat=Selected: \{0\}}"
                                   FontWeight="Bold"/>
                        
                    </Grid>                    
                </Expander>
                <Expander Header="Edit Selected Volume Surfaces"
                          Style="{DynamicResource ViewportExpander}"
                          IsExpanded="{Binding ElementName=tg_zgd_VolumeBTEdit, Path=IsChecked, Mode=OneWay}"
                          Visibility="{Binding ElementName=tg_zgd_VolumeBTEdit, Path=IsChecked, Converter={StaticResource BoolToVisConverter}, Mode=OneWay}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="5"/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="Auto" MinHeight="60" MaxHeight="250"/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="5"/>
                        </Grid.RowDefinitions>

                        <TreeView Grid.Row="4" x:Name="tv_VolumeSurfaces"  HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                                  Margin="5,0" MinWidth="185" Width="Auto" Height="Auto"
                                  ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                                  ScrollViewer.VerticalScrollBarVisibility="Visible"
                                  ItemsSource="{Binding ElementName=zoneGroupDisplay, Path=ZonedVolumeSurfaces, Mode=TwoWay}"
                                  ItemTemplate="{StaticResource VolumeSurfaceInList}"
                                  ItemContainerStyle="{DynamicResource TreeItemForLayers}">
                            <i:Interaction.Behaviors>
                                <!-- the SelectedItem Property is READONLY -->
                                <gvxuie:BindableSelectedItemBehavior SelectedItem="{Binding ElementName=zoneGroupDisplay, Path=SelectedVSurf, Mode=TwoWay}"/>
                            </i:Interaction.Behaviors>
                        </TreeView>

                        <GridSplitter Grid.Row="5" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="5,0" Height="3" ResizeDirection="Rows"
                                       Background="{DynamicResource {x:Static SystemColors.MenuBarBrushKey}}" 
                                       BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkDarkBrushKey}}"
                                       BorderThickness="1"/>

                        <TextBlock Grid.Row="6" HorizontalAlignment="Left" Margin="5,4,0,0" Width="150" Height="20" Text="{Binding ElementName=zoneGroupDisplay, Path=SelectedVSurf.EntityName}" TextAlignment="Left"/>

                        <TextBlock Grid.Row="7" HorizontalAlignment="Left" Margin="5,5,0,0" Height="22" Width="47" Text="Material:"/>
                        <ComboBox Grid.Row="7" HorizontalAlignment="Stretch" Margin="57,5,5,0" Height="25" 
                                  ItemsSource="{Binding ElementName=zoneGroupDisplay, Path=MaterialLibrary}"
                                  ItemTemplate="{DynamicResource MaterialInComboBox}"
                                  SelectedItem="{Binding ElementName=zoneGroupDisplay, Path=MaterialOfSelectedVSurf, Mode=TwoWay}"/>
                    </Grid>
                    
                </Expander>
                <Expander Header="Components" Style="{DynamicResource ViewportExpander}" UseLayoutRounding="True"
                          IsExpanded="True"
                          Visibility="{Binding ElementName=tool_SpacesOpenings, Path=IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisConverter}}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <!-- 0 - 2: GENERAL FUNCTIONALITY -->
                            <RowDefinition/>                            
                            <RowDefinition/>
                            <RowDefinition/>
                            <!-- 3 - 6: COMPONENT REPRESENTATIONS -->
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="Auto" MinHeight="60" MaxHeight="500"/>
                            <RowDefinition/>
                            <!-- 7 - 8: SPACE ASSOCIATION FUNCTIONS -->
                            <RowDefinition/>
                            <RowDefinition/>
                            <!-- 9 - 11: PLACEMENT FUNCTIONS -->
                            <RowDefinition/>                            
                            <RowDefinition/>
                            <RowDefinition/>
                            <!-- 12 - 14: CONNECTING FUNCTIONS -->
                            <RowDefinition/>
                            <RowDefinition/>                            
                            <RowDefinition/>
                            <!-- 15 - 16: MATERIAL FUNCTIONS -->
                            <RowDefinition/>
                            <RowDefinition/>
                            <!-- 17 - 21: MATERIALS -->
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition  Height="Auto" MinHeight="60" MaxHeight="500"/>
                            <RowDefinition/>
                            <RowDefinition/>
                            <!-- 22 - 23 SELECTION -->
                            <RowDefinition/>
                            <RowDefinition/>
                            <RowDefinition Height="5"/>
                        </Grid.RowDefinitions>

                        <!-- general functionality and messages -->
                        <TextBlock Grid.Row="0" Text="ALLGEMEINE FUNKTIONEN" Foreground="DimGray" FontWeight="Bold" FontSize="10" Margin="25,0,0,0" HorizontalAlignment="Left"/>
                        <TextBlock Grid.Row="0" Text="ABLAUF" Foreground="DimGray" FontWeight="Bold" FontSize="10" HorizontalAlignment="Right" Margin="0,0,100,0" Width="160"/>
                        <TextBlock Grid.Row="0" Text="WARNUNGEN" Foreground="DimGray" FontWeight="Bold" FontSize="10" HorizontalAlignment="Right" Margin="0,0,10,0"/>
                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="25,2,300,5">
                            <Button HorizontalAlignment="Left" Height="26" Width="26"
                                    Style="{StaticResource ReliefButton_Important}"    
                                    ToolTip="{Binding ElementName=MainView, Path=NrReferencesToSendToCBString, Mode=OneWay}"
                                    Command="{Binding ElementName=MainView, Path=TransferDeferredCompRepsCmd, Mode=OneWay}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/space_SP2VOL_transfer_refs.png"/>
                                </Button.Content>
                            </Button>
                        </StackPanel>
                        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,2,100,5">
                            <Border Width="30" Height="30"  Margin="0,0,2,0"
                                    Style="{Binding ElementName=zoneGroupDisplay, Path=SomeGeometryLoaded, Mode=OneWay,Converter={StaticResource BooleanToBorderStyleConverter}}"
                                    ToolTip="Vorschlag 1.Schritt: Geometrie laden">
                                <Image Source="./Data/Icons/comp_transf_1.png" Width="24"
                                       ToolTip="Vorschlag 1.Schritt: Geometrie laden"/>
                            </Border>
                            <Border Width="30" Height="30" Margin="0,0,2,0"
                                    Style="{Binding ElementName=dgNeighborVolumes, Path=NeighborsUpToDate,Mode=OneWay, Converter={StaticResource BooleanToBorderStyleConverter}}"
                                    ToolTip="Vorschlag 2.Schritt: Nachbarn finden">
                                <Image Source="./Data/Icons/comp_transf_2.png" Width="24"
                                       ToolTip="Vorschlag 2.Schritt: Nachbarn finden"/>
                            </Border>
                            <Border Width="30" Height="30" Margin="0,0,2,0"
                                    Style="{Binding ElementName=compDisplay, Path=AlignedWithCompRepsLoaded, Mode=OneWay, Converter={StaticResource BooleanToBorderStyleConverter}}"
                                    ToolTip="Vorschlag 3.Schritt: Aufbauten-Komponenten laden">
                                <Image Source="./Data/Icons/comp_transf_3.png" Width="24"
                                       ToolTip="Vorschlag 3.Schritt: Aufbauten-Komponenten laden"/>
                            </Border>
                            <Border Width="30" Height="30" Margin="0,0,2,0"
                                    Style="{Binding ElementName=compDisplay,Path=DescribingCompRepsLoaded, Mode=OneWay, Converter={StaticResource BooleanToBorderStyleConverter}}"
                                    ToolTip="Vorschlag 4.Schritt: raumbeschreibende Komponenten laden">
                                <Image Source="./Data/Icons/comp_transf_4.png" Width="24"
                                       ToolTip="Vorschlag 4.Schritt: raumbeschreibende Komponenten laden"/>
                            </Border>
                            <Border Width="30" Height="30" Margin="0,0,2,0"
                                    Style="{Binding ElementName=compDisplay, Path=ContainedInCompRepsLoaded, Mode=OneWay, Converter={StaticResource BooleanToBorderStyleConverter}}"
                                    ToolTip="Vorschlag 5.Schritt: Analgen-Komponenten laden">
                                <Image Source="./Data/Icons/comp_transf_5.png" Width="24"
                                       ToolTip="Vorschlag 5.Schritt: Analgen-Komponenten laden"/>
                            </Border>
                        </StackPanel>
                        <StackPanel  Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,2,10,5">
                            <Image Source="./Data/Icons/msg_Warning_1.png" Width="24" HorizontalAlignment="Left" Margin="6,0,2,0"
                                   Visibility="{Binding ElementName=MainView, Path=SendNOUpdatesOverComm, Mode=OneWay, Converter={StaticResource BoolToVisConverter}}">
                                <Image.ToolTip>
                                    <ToolTip Content="WARNUNG: Es werden keine Updates nach ComponentBuilder geschickt!" Style="{StaticResource ToolTipImportant}"/>
                                </Image.ToolTip>
                            </Image>
                            <Image Source="./Data/Icons/msg_Warning.png" Width="24" HorizontalAlignment="Left" Margin="2,0,2,0"
                                   Visibility="{Binding ElementName=dgNeighborVolumes, Path=NeighborsUpToDate, Converter={StaticResource ReverseBoolToVisConverterGroup}}">
                                <Image.ToolTip>
                                    <ToolTip Content="WARNUNG: Nachbarn nicht up-to-date!" Style="{StaticResource ToolTipImportant}"/>
                                </Image.ToolTip>
                            </Image>
                        </StackPanel>

                        <!-- component representations -->
                        <TextBlock Grid.Row="3" Text="ÜBERTRAGENE KOMPONENTEN" Foreground="DimGray" FontWeight="Bold" FontSize="10" Margin="25,0,0,0"/>
                        <Border Grid.Row="4" Margin="5,0,5,0" BorderThickness="1" BorderBrush="DimGray"/>
                        <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="25,0,5,0">
                            <TextBlock Text="Komponente" Foreground="DimGray" Width="280"/>
                            <TextBlock Text="Geometrie" Foreground="DimGray" Width="70" Margin="4,0,0,0"/>
                            <TextBlock Text="Comp Rep IDs" Foreground="Gray" Width="80" Margin="4,0,0,0" FontSize="10"/>
                        </StackPanel>
                        <gvxuie:TreeViewExt Grid.Row="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                                  Margin="5,0" MinWidth="185" Width="Auto" Height="Auto"
                                  ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                                  ScrollViewer.VerticalScrollBarVisibility="Visible"
                                  ItemsSource="{Binding ElementName=compDisplay, Path=ExistingCompReps, Mode=TwoWay, Converter={StaticResource TreeViewSortingCompRepConverter}}"
                                  SelectedItem_="{Binding ElementName=compDisplay, Path=SelectedCompRep, Mode=TwoWay}"
                                  AllowNoSelection="True"
                                  ItemTemplate="{StaticResource CompRepInList}"
                                  ItemContainerStyle="{StaticResource TreeItemForCompReps}"
                                  AlternationCount="2"
                                  Grid.IsSharedSizeScope="True"
                                  Background="{Binding ElementName=dgNeighborVolumes, Path=NeighborsUpToDate, Mode=OneWay, Converter={StaticResource BoolToLinearGradientBrushConverter}}"
                                  >
                            <gvxuie:TreeViewExt.Resources>
                                <Style TargetType="{x:Type TreeViewItem}">
                                    <Setter Property="HorizontalContentAlignment" Value="Left" />
                                    <Setter Property="VerticalContentAlignment" Value="Center" />
                                </Style>
                            </gvxuie:TreeViewExt.Resources>
                            <!--<gvxuie:TreeViewExt.Background>
                                <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                    <GradientStop Color="#FFd9d9d9" Offset="0"/>
                                    <GradientStop Color="#FFf5f5f5" Offset="1"/>
                                </LinearGradientBrush>
                            </gvxuie:TreeViewExt.Background>-->
                        </gvxuie:TreeViewExt>

                        <GridSplitter Grid.Row="6" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="5,0" Height="3" ResizeDirection="Rows"
                                       Background="{DynamicResource {x:Static SystemColors.MenuBarBrushKey}}" 
                                       BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkDarkBrushKey}}"
                                       BorderThickness="1"/>

                        <!-- space association functions -->
                        <TextBlock Grid.Row="7" Text="RAUMBEZOGENE FUNKTIONEN" Foreground="DimGray" FontWeight="Bold" FontSize="10" Margin="25,0,0,0"/>
                        <!--<Border Grid.Row="8" Margin="5,0,5,0" BorderThickness="1" BorderBrush="DimGray"/>-->
                        <Rectangle Grid.Row="8" Margin="5,0,5,0" StrokeThickness="1" Stroke="DimGray" Fill="#15000000" IsHitTestVisible="False"/>
                        <StackPanel Grid.Row="8" Orientation="Horizontal" Margin="10,2,10,2">
                            <StackPanel.IsEnabled>
                                <MultiBinding Converter="{StaticResource BoolAndConverter}" ConverterParameter="{StaticResource FalseValue}" UpdateSourceTrigger="PropertyChanged" Mode="OneWay">
                                    <Binding ElementName="MainView" Path="FinishedSendingMessages" Mode="OneWay"/>
                                    <Binding ElementName="MainView" Path="LoggedUser" Mode="OneWay" Converter="{StaticResource UserRoleToBooleanConverter}" ConverterParameter="ALL_RIGHTS+DRAWING_RIGHTS+ZONING_RIGHTS"/>
                                </MultiBinding>
                            </StackPanel.IsEnabled>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" 
                                    Style="{DynamicResource ReliefButton}"
                                    Command="{Binding ElementName=CommandExt, Path=AssociateCompRepWZonedVolumeCmd, Mode=OneWay}"
                                    ToolTip="Komponente mit Geometrie verknüpfen">
                                <Button.Content>
                                    <Image Source="./Data/Icons/space_SP2VOL.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Margin="2,0,0,0" Height="26" Width="26" 
                                    Style="{DynamicResource ReliefButton}"
                                    ToolTip="Komponente von Geometrie trennen"
                                    Command="{Binding ElementName=compDisplay, Path=DisAssociateCompRepWZonedVolumeCmd, Mode=OneWay}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/space_SP2VOL_remove.png"/>
                                </Button.Content>
                            </Button>
                        </StackPanel>

                        <!-- placement functions -->
                        <TextBlock Grid.Row="9" Text="VERORTUNGSFUNKTIONEN" Foreground="DimGray" FontWeight="Bold" FontSize="10" Margin="25,0,0,0"/>
                        <!--<Border Grid.Row="10" Grid.RowSpan="2" Margin="5,0,5,0" BorderThickness="1" BorderBrush="DimGray"/>-->
                        <Rectangle Grid.Row="10" Grid.RowSpan="2" Margin="5,0,5,0" StrokeThickness="1" Stroke="DimGray" Fill="#15000000" IsHitTestVisible="False"/>
                        <StackPanel Grid.Row="10" Orientation="Horizontal" Margin="10,2,10,2">
                            <StackPanel.IsEnabled>
                                <MultiBinding Converter="{StaticResource BoolAndConverter}" ConverterParameter="{StaticResource FalseValue}" UpdateSourceTrigger="PropertyChanged" Mode="OneWay">
                                    <Binding ElementName="compDisplay" Path="SelectedIsContainedInInstance" Mode="OneWay"/>
                                    <Binding ElementName="MainView" Path="LoggedUser" Mode="OneWay" Converter="{StaticResource UserRoleToBooleanConverter}" ConverterParameter="ALL_RIGHTS+INSERTION_RIGHTS"/>
                                </MultiBinding>
                            </StackPanel.IsEnabled>
                            <Button HorizontalAlignment="Left" Height="26" Width="26" 
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=CommandExt, Path=PlaceCompRepInZonedVolumeCmd, Mode=OneWay}"
                                ToolTip="Komponente in Geometrie setzen">
                                <Button.Content>
                                    <Image Source="./Data/Icons/space_HVAC2VOL.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Margin="2,0,0,0" Height="26" Width="26" 
                                Style="{DynamicResource ReliefButton}"
                                Command="{Binding ElementName=compDisplay, Path=RemovingPlacementCmd, Mode=OneWay}"
                                ToolTip="Komponente von Geometrie enfernen">
                                <Button.Content>
                                    <Image Source="./Data/Icons/space_HVAC2VOL_remove.png"/>
                                </Button.Content>
                            </Button>
                            <Button HorizontalAlignment="Left" Margin="2,0,0,0" Height="26" Width="26" 
                                    Style="{DynamicResource ReliefButton}"
                                    Command="{Binding ElementName=CommandExt, Path=AlignCompRepWZonedVolumeCmd, Mode=OneWay}"
                                    ToolTip="Komponente an Wand ausrichten">
                                <Button.Content>
                                    <Image Source="./Data/Icons/space_SP2MAT.png"/>
                                </Button.Content>
                            </Button>

                            <ToggleButton Style="{StaticResource ToggleButtonLight}" Width="26" Height="26" Margin="36,0,10,0"
                                          ToolTip="Show local coordiante system"
                                          IsChecked="{Binding ElementName=compDisplay, Path=ShowCS, Mode=TwoWay}">
                                <ToggleButton.Content>
                                    <Image Source="./Data/Icons/path_ucs.png"/>
                                </ToggleButton.Content>
                            </ToggleButton>

                            <TextBlock HorizontalAlignment="Left" Height="20" Margin="2,0,0,0" Text="Schritt:"  Foreground="DimGray"/>
                            <TextBox Margin="5,2,0,0" Width="45" Style="{DynamicResource CoordinateInput}"
                                 Text="{Binding ElementName=compDisplay, Path=TranslationStep, Mode=TwoWay, Converter={StaticResource DoubleToStringConverter}, StringFormat=\{0:0.0000\}, FallbackValue=0.0}" />
                        </StackPanel>
                        <StackPanel Grid.Row="11" Orientation="Horizontal" Margin="10,3,10,2">
                            <StackPanel.IsEnabled>
                                <MultiBinding Converter="{StaticResource BoolAndConverter}" ConverterParameter="{StaticResource FalseValue}" UpdateSourceTrigger="PropertyChanged" Mode="OneWay">
                                    <Binding ElementName="compDisplay" Path="SelectedIsContainedInInstance" Mode="OneWay"/>
                                    <Binding ElementName="MainView" Path="LoggedUser" Mode="OneWay" Converter="{StaticResource UserRoleToBooleanConverter}" ConverterParameter="ALL_RIGHTS+INSERTION_RIGHTS"/>
                                </MultiBinding>
                            </StackPanel.IsEnabled>

                            <TextBlock HorizontalAlignment="Left" Height="20" Width="18" Margin="2,0,0,0" Text="dX:" Foreground="DimGray"/>
                            <Button Style="{StaticResource ReliefButton_BackwTriangle}" Width="22" Height="26"
                                    Command="{Binding ElementName=compDisplay, Path=MovePlacableAlongXCmd,Mode=OneWay}"
                                    CommandParameter="{StaticResource FalseValue}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/op_minX.png" Width="16"/>
                                </Button.Content>
                            </Button>
                            <Button Style="{StaticResource ReliefButton_ForwTriangle}" Width="26" Height="26"
                                    Command="{Binding ElementName=compDisplay, Path=MovePlacableAlongXCmd,Mode=OneWay}"
                                    CommandParameter="{StaticResource TrueValue}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/op_plusX.png" Width="16"/>
                                </Button.Content>
                            </Button>

                            <TextBlock HorizontalAlignment="Left" Height="20" Width="18" Margin="8,0,0,0" Text="dY:"  Foreground="DimGray"/>
                            <Button Style="{StaticResource ReliefButton_BackwTriangle}" Width="22" Height="26"
                                    Command="{Binding ElementName=compDisplay, Path=MovePlacableAlongZCmd,Mode=OneWay}"
                                    CommandParameter="{StaticResource FalseValue}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/op_minZ.png" Width="16"/>
                                </Button.Content>
                            </Button>
                            <Button Style="{StaticResource ReliefButton_ForwTriangle}" Width="26" Height="26"
                                    Command="{Binding ElementName=compDisplay, Path=MovePlacableAlongZCmd,Mode=OneWay}"
                                    CommandParameter="{StaticResource TrueValue}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/op_plusZ.png" Width="16"/>
                                </Button.Content>
                            </Button>

                            <TextBlock HorizontalAlignment="Left" Height="20" Margin="8,0,0,0" Text="dZ:"  Foreground="DimGray"/>
                            <Button Style="{StaticResource ReliefButton_BackwTriangle}" Width="22" Height="26"
                                    Command="{Binding ElementName=compDisplay, Path=MovePlacableAlongYCmd,Mode=OneWay}"
                                    CommandParameter="{StaticResource FalseValue}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/op_minY.png" Width="16"/>
                                </Button.Content>
                            </Button>
                            <Button Style="{StaticResource ReliefButton_ForwTriangle}" Width="26" Height="26"
                                    Command="{Binding ElementName=compDisplay, Path=MovePlacableAlongYCmd,Mode=OneWay}"
                                    CommandParameter="{StaticResource TrueValue}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/op_plusY.png" Width="16"/>
                                </Button.Content>
                            </Button>
                        </StackPanel>

                        <!-- connection functions -->
                        <TextBlock Grid.Row="12" Text="VERBINDUNGSFUNKTIONEN" Foreground="DimGray" FontWeight="Bold" FontSize="10" Margin="25,0,0,0"/>
                        <!--<Border Grid.Row="13" Grid.RowSpan="2" Margin="5,0,5,0" BorderThickness="1" BorderBrush="DimGray"/>-->
                        <Rectangle Grid.Row="13" Grid.RowSpan="2" Margin="5,0,5,0" StrokeThickness="1" Stroke="DimGray" Fill="#15000000" IsHitTestVisible="False"/>
                        <ToggleButton Grid.Row="13" Style="{StaticResource ToggleButtonLight}" Width="26" Height="26"
                                          HorizontalAlignment="Left" Margin="10,2,0,2"
                                          ToolTip="Toggle path editing for connecting elements"
                                          IsChecked="{Binding ElementName=compDisplay, Path=PathEditingModeOn, Mode=TwoWay}">
                            <ToggleButton.Content>
                                <Image Source="./Data/Icons/path_edit.png"/>
                            </ToggleButton.Content>
                            <ToggleButton.IsEnabled>
                                <MultiBinding Converter="{StaticResource BoolAndConverter}" ConverterParameter="{StaticResource FalseValue}" UpdateSourceTrigger="PropertyChanged" Mode="OneWay">
                                    <Binding ElementName="compDisplay" Path="SelectedIsConnectingInstance" Mode="OneWay"/>
                                    <Binding ElementName="MainView" Path="LoggedUser" Mode="OneWay" Converter="{StaticResource UserRoleToBooleanConverter}" ConverterParameter="ALL_RIGHTS+INSERTION_RIGHTS"/>
                                </MultiBinding>
                            </ToggleButton.IsEnabled>
                        </ToggleButton>
                        <StackPanel Grid.Row="13" Orientation="Horizontal" Margin="46,2,10,2"
                                    IsEnabled="{Binding ElementName=compDisplay, Path=PathEditingModeOn, Mode=OneWay}">
                            <ToggleButton Style="{StaticResource ToggleButtonLight}" Width="26" Height="26"
                                          HorizontalAlignment="Left" Margin="2,0,0,0"
                                          ToolTip="Der Verbindung einen Punkt hinzufügen (normaler Verlauf)"
                                          IsEnabled="{Binding ElementName=compDisplay, Path=PathEditMode, Mode=OneWay, 
                                                              Converter={StaticResource PathEditingModeToBooleanConverter}, ConverterParameter=NEUTRAL+ADD_POINT_SINGLE}"
                                          IsChecked="{Binding ElementName=compDisplay, Path=PathEditMode, Mode=OneWay, 
                                                              Converter={StaticResource PathEditingModeToBooleanConverter}, ConverterParameter=ADD_POINT_SINGLE}"
                                          Command="{Binding ElementName=compDisplay, Path=SwitchPathEditModeCmd, Mode=OneWay}"
                                          CommandParameter="ADD_POINT_SINGLE"
                                          >
                                <ToggleButton.Content>
                                    <Image Source="./Data/Icons/path_newV_normal.png"/>
                                </ToggleButton.Content>
                            </ToggleButton>
                            <ToggleButton Style="{StaticResource ToggleButtonLight}" Width="26" Height="26"
                                          HorizontalAlignment="Left" Margin="2,0,0,0"
                                          ToolTip="Der Verbindung einen Punkt hinzufügen (Stufenverlauf)"
                                          IsEnabled="{Binding ElementName=compDisplay, Path=PathEditMode, Mode=OneWay, 
                                                              Converter={StaticResource PathEditingModeToBooleanConverter}, ConverterParameter=NEUTRAL+ADD_POINT_MULTIPLE}"
                                          IsChecked="{Binding ElementName=compDisplay, Path=PathEditMode, Mode=OneWay, 
                                                              Converter={StaticResource PathEditingModeToBooleanConverter}, ConverterParameter=ADD_POINT_MULTIPLE}"
                                          Command="{Binding ElementName=compDisplay, Path=SwitchPathEditModeCmd, Mode=OneWay}"
                                          CommandParameter="ADD_POINT_MULTIPLE">
                                <ToggleButton.Content>
                                    <Image Source="./Data/Icons/path_newV_step.png"/>
                                </ToggleButton.Content>
                            </ToggleButton>
                            <ToggleButton Style="{StaticResource ToggleButtonLight}" Width="26" Height="26"
                                          HorizontalAlignment="Left" Margin="2,0,0,0"
                                          ToolTip="Punkt verschieben"
                                          IsEnabled="{Binding ElementName=compDisplay, Path=PathEditMode, Mode=OneWay, 
                                                              Converter={StaticResource PathEditingModeToBooleanConverter}, ConverterParameter=NEUTRAL+MOVE_POINT_SINGLE}"
                                          IsChecked="{Binding ElementName=compDisplay, Path=PathEditMode, Mode=OneWay, 
                                                              Converter={StaticResource PathEditingModeToBooleanConverter}, ConverterParameter=MOVE_POINT_SINGLE}"
                                          Command="{Binding ElementName=compDisplay, Path=SwitchPathEditModeCmd, Mode=OneWay}"
                                          CommandParameter="MOVE_POINT_SINGLE">
                                <ToggleButton.Content>
                                    <Image Source="./Data/Icons/path_moveV_single.png"/>
                                </ToggleButton.Content>
                            </ToggleButton>
                            <ToggleButton Style="{StaticResource ToggleButtonLight}" Width="26" Height="26"
                                          HorizontalAlignment="Left" Margin="2,0,0,0"
                                          ToolTip="mehrere Punkte entlang der gleichen Axe verschieben"
                                          IsEnabled="{Binding ElementName=compDisplay, Path=PathEditMode, Mode=OneWay, 
                                                              Converter={StaticResource PathEditingModeToBooleanConverter}, ConverterParameter=NEUTRAL+MOVE_POINT_MULTIPLE}"
                                          IsChecked="{Binding ElementName=compDisplay, Path=PathEditMode, Mode=OneWay, 
                                                              Converter={StaticResource PathEditingModeToBooleanConverter}, ConverterParameter=MOVE_POINT_MULTIPLE}"
                                          Command="{Binding ElementName=compDisplay, Path=SwitchPathEditModeCmd, Mode=OneWay}"
                                          CommandParameter="MOVE_POINT_MULTIPLE">
                                <ToggleButton.Content>
                                    <Image Source="./Data/Icons/path_moveV_multi.png"/>
                                </ToggleButton.Content>
                            </ToggleButton>
                            <ToggleButton Style="{StaticResource ToggleButtonLight}" Width="26" Height="26"
                                          HorizontalAlignment="Left" Margin="2,0,0,0"
                                          ToolTip="Punkt löschen"
                                          IsEnabled="{Binding ElementName=compDisplay, Path=PathEditMode, Mode=OneWay, 
                                                              Converter={StaticResource PathEditingModeToBooleanConverter}, ConverterParameter=NEUTRAL+DELETE_POINT}"
                                          IsChecked="{Binding ElementName=compDisplay, Path=PathEditMode, Mode=OneWay, 
                                                              Converter={StaticResource PathEditingModeToBooleanConverter}, ConverterParameter=DELETE_POINT}"
                                          Command="{Binding ElementName=compDisplay, Path=SwitchPathEditModeCmd, Mode=OneWay}"
                                          CommandParameter="DELETE_POINT">
                                <ToggleButton.Content>
                                    <Image Source="./Data/Icons/path_delV.png"/>
                                </ToggleButton.Content>
                            </ToggleButton>
                            <Button Style="{StaticResource ReliefButton_Important}" Width="26" Height="26"
                                    HorizontalAlignment="Left" Margin="29,0,0,0"
                                    ToolTip="Änderung rückgängig machen"
                                    Command="{Binding ElementName=compDisplay,Path=TraverseHistoryBackwardsCmd, Mode=OneWay}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/path_ctrlZ.png"/>
                                </Button.Content>
                            </Button>
                            <Button Style="{StaticResource ReliefButton_Important}" Width="26" Height="26"
                                    HorizontalAlignment="Left" Margin="2,0,0,0"
                                    ToolTip="Änderung wiederholen"
                                    Command="{Binding ElementName=compDisplay, Path=TraverseHistoryForewardsCmd,Mode=OneWay}">
                                <Button.Content>
                                    <Image Source="./Data/Icons/path_ctrlY.png"/>
                                </Button.Content>
                            </Button>
                        </StackPanel>
                        <StackPanel Grid.Row="14" Orientation="Horizontal" Margin="10,2,10,5"
                                    IsEnabled="{Binding ElementName=compDisplay, Path=SelectedIsConnectingInstance,Mode=OneWay}">
                            <Image Source="./Data/Icons/constraint_lock.png" Height="16" Width="16" ToolTip="keine Verschiebung entlang der X-Achse"/>
                            <TextBlock Text="X:" Foreground="DimGray" FontWeight="Bold" Margin="0,2,0,0"/>
                            <CheckBox Margin="0,2,0,0"  ToolTip="keine Verschiebung entlang der X-Achse" 
                                      IsChecked="{Binding ElementName=compDisplay, Path=DragX, Mode=TwoWay, Converter={StaticResource InverseBooleanConverter}}"/>

                            <Image Source="./Data/Icons/constraint_lock.png" Height="16" Width="16" Margin="5,0,0,0"  ToolTip="keine Verschiebung entlang der Y-Achse"/>
                            <TextBlock Text="Y:" Foreground="DimGray" FontWeight="Bold" Margin="0,2,0,0"/>
                            <CheckBox Margin="0,2,0,0"  ToolTip="keine Verschiebung entlang der Y-Achse"
                                      IsChecked="{Binding ElementName=compDisplay, Path=DragY, Mode=TwoWay, Converter={StaticResource InverseBooleanConverter}}"/>

                            <Image Source="./Data/Icons/constraint_lock.png" Height="16" Width="16" Margin="5,0,0,0"  ToolTip="keine Verschiebung entlang der Z-Achse"/>
                            <TextBlock Text="Z:" Foreground="DimGray" FontWeight="Bold" Margin="0,2,0,0"/>
                            <CheckBox Margin="0,2,0,0"  ToolTip="keine Verschiebung entlang der Z-Achse"
                                      IsChecked="{Binding ElementName=compDisplay, Path=DragZ, Mode=TwoWay, Converter={StaticResource InverseBooleanConverter}}"/>

                            <Image Source="./Data/Icons/constraint_link.png" Height="16" Width="16" Margin="15,0,0,0"  ToolTip="Vertices mit gemeinsamer X-Achse gemeinsam verschieben"/>
                            <TextBlock Text="X:" Foreground="DimGray" FontWeight="Bold" Margin="0,2,0,0"/>
                            <CheckBox Margin="0,2,0,0"  ToolTip="Vertices mit gemeinsamer X-Achse gemeinsam verschieben"
                                      IsChecked="{Binding ElementName=compDisplay, Path=LinkX, Mode=TwoWay}"/>

                            <Image Source="./Data/Icons/constraint_link.png" Height="16" Width="16" Margin="5,0,0,0"  ToolTip="Vertices mit gemeinsamer Y-Achse gemeinsam verschieben"/>
                            <TextBlock Text="Y:" Foreground="DimGray" FontWeight="Bold" Margin="0,2,0,0"/>
                            <CheckBox Margin="0,2,0,0"  ToolTip="Vertices mit gemeinsamer Y-Achse gemeinsam verschieben"
                                      IsChecked="{Binding ElementName=compDisplay, Path=LinkY, Mode=TwoWay}"/>

                            <Image Source="./Data/Icons/constraint_link.png" Height="16" Width="16" Margin="5,0,0,0"  ToolTip="Vertices mit gemeinsamer Z-Achse gemeinsam verschieben"/>
                            <TextBlock Text="Z:" Foreground="DimGray" FontWeight="Bold" Margin="0,2,0,0"/>
                            <CheckBox Margin="0,2,0,0"  ToolTip="Vertices mit gemeinsamer Z-Achse gemeinsam verschieben"
                                      IsChecked="{Binding ElementName=compDisplay, Path=LinkZ, Mode=TwoWay}"/>

                        </StackPanel>

                        <!-- material functions: TODO -->
                              
                        <!-- material list -->
                        <TextBlock Grid.Row="17" Text="AUFBAUTEN" Foreground="DimGray" FontWeight="Bold" FontSize="10" Margin="25,0,0,0"/>
                        <Border Grid.Row="18" Margin="5,0,5,0" BorderThickness="1" BorderBrush="DimGray"/>
                        <StackPanel Grid.Row="18" Orientation="Horizontal" Margin="25,0,5,0">
                            <TextBlock Text="Aufbau" Foreground="DimGray" Width="280"/>
                            <TextBlock Text="Geometrie" Foreground="DimGray" Width="70" Margin="4,0,0,0"/>
                            <TextBlock Text="Comp Rep IDs" Foreground="Gray" Width="80" Margin="4,0,0,0" FontSize="10"/>
                        </StackPanel>
                        <gvxuie:TreeViewExt Grid.Row="19" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                                  Margin="5,0" MinWidth="185" Width="Auto" Height="Auto"
                                  ScrollViewer.HorizontalScrollBarVisibility="Hidden"
                                  ScrollViewer.VerticalScrollBarVisibility="Visible"
                                  ItemsSource="{Binding ElementName=zoneGroupDisplay, Path=MaterialLibrary, Mode=OneWay}"                                         
                                  AllowNoSelection="True"
                                  ItemTemplateSelector="{StaticResource DataTemplateSelectorMaterial}"
                                  ItemContainerStyle="{StaticResource TreeItemForMaterials}"
                                  AlternationCount="2"
                                  Grid.IsSharedSizeScope="True"
                                  >
                            <gvxuie:TreeViewExt.Resources>
                                <Style TargetType="{x:Type TreeViewItem}">
                                    <Setter Property="HorizontalContentAlignment" Value="Left" />
                                    <Setter Property="VerticalContentAlignment" Value="Center" />
                                </Style>
                            </gvxuie:TreeViewExt.Resources>
                            <gvxuie:TreeViewExt.Background>
                                <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                    <GradientStop Color="#FFAAA9A9" Offset="0"/>
                                    <GradientStop Color="#FFd9d9d9" Offset="1"/>
                                </LinearGradientBrush>
                            </gvxuie:TreeViewExt.Background>
                        </gvxuie:TreeViewExt>

                        <GridSplitter Grid.Row="20" VerticalAlignment="Center" HorizontalAlignment="Stretch" Margin="5,0" Height="3" ResizeDirection="Rows"
                                       Background="{DynamicResource {x:Static SystemColors.MenuBarBrushKey}}" 
                                       BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkDarkBrushKey}}"
                                       BorderThickness="1"/>



                        <TextBlock Grid.Row="22" HorizontalAlignment="Stretch" Height="25" Margin="5,5,5,0" 
                                   TextAlignment="Left"
                                   Padding="0,0,2,0"
                                   Text="{Binding ElementName=compDisplay, Path=SelectedCompRep.Comp_Description, StringFormat=Selected: \{0\}}"
                                   FontWeight="Bold"/>
                        

                    </Grid>
                </Expander>
            </StackPanel>
        </ScrollViewer>

        <GridSplitter Grid.Column="0" Grid.Row="2" Width="3" Margin="0" HorizontalAlignment="Right" VerticalAlignment="Stretch" ResizeDirection="Columns" 
                      Background="{DynamicResource {x:Static SystemColors.MenuBarBrushKey}}" 
                      BorderBrush="{DynamicResource {x:Static SystemColors.ControlDarkDarkBrushKey}}"
                      BorderThickness="1"/>
        
        <!-- Console -->
        <Expander Grid.Row="2" Grid.Column="0" Header="Console" Style="{StaticResource ViewportExpander}" 
                  IsExpanded="True" Width="Auto" VerticalAlignment="Bottom" HorizontalAlignment="Left" UseLayoutRounding="True"
                  Visibility="{Binding ElementName=chb_ConsoleVis, Path=IsChecked, Mode=OneWay, Converter={StaticResource BoolToVisConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="70" MaxHeight="200" MinHeight="70"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="5"/>
                </Grid.RowDefinitions>
                <ListView Grid.Row="1" Margin="5,2,5,0" Height="Auto" Width="Auto" MaxWidth="918" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                                      ScrollViewer.HorizontalScrollBarVisibility="Visible" ScrollViewer.VerticalScrollBarVisibility="Visible" 
                                      gvxuie:ListViewExt.AutoScrollToEnd="True"
                                      ItemsSource="{Binding ElementName=MainView, Path=ExistingLoggerEntries, Mode=OneWay}"
                                      ItemTemplate="{StaticResource LogEntryInList}"
                                      Foreground="White" BorderBrush="Black"
                                      >
                    <ListView.Background>
                        <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                            <GradientStop Color="#FF999999" Offset="0"/>
                            <GradientStop Color="#FF595959" Offset="1"/>
                        </LinearGradientBrush>
                    </ListView.Background>
                </ListView>
                <Image Grid.Row="1" Margin="7,3,6,1" Source="./Data/Icons/console_brg.png" Opacity="1"
                                   HorizontalAlignment="Stretch" VerticalAlignment="Stretch" IsHitTestVisible="False" 
                                   ScrollViewer.VerticalScrollBarVisibility="Disabled" Stretch="Fill" MaxWidth="918" MaxHeight="198"/>
                <GridSplitter Grid.Row="2" Width="Auto" Height="4" BorderBrush="DimGray" BorderThickness="1"
                              HorizontalAlignment="Stretch" Margin="5,0"/>
            </Grid>
        </Expander>

        <StatusBar Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2" VerticalAlignment="Bottom">
            <StatusBar.Background>
                <SolidColorBrush Opacity="0.3" Color="WhiteSmoke"/>
            </StatusBar.Background>
            <StatusBarItem>
                <TextBlock VerticalAlignment="Top" HorizontalAlignment="Left" Text="{Binding FpsCounter.Value, ElementName=MainView, StringFormat=Framerate - \{0:0.00\} FPS}"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="{Binding Camera.Position, StringFormat=Pos: \{0:0.0\}}"/>
            </StatusBarItem>
            <StatusBarItem>
                <TextBlock Text="{Binding Camera.LookDirection.Length, StringFormat=Dist: \{0:0.0\}}"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="{Binding Camera.LookDirection, StringFormat=LookDir: \{0:0.0\}}"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="{Binding Camera.UpDirection, StringFormat=UpDir: \{0:0.0\}}"/>
            </StatusBarItem>
            <Separator/>
            <!--<StatusBarItem>
                <TextBlock Text="{Binding Items.Count, ElementName=MainView, StringFormat=Children: \{0\}}"/>
            </StatusBarItem>
            <Separator/>-->
            <Separator/>
            
            <!-- OBJECT SNAP CONTROLS-->
            <StatusBarItem>
                <TextBlock Margin="0,0,5,0" FontWeight="Bold" Text="Object Snap:"/>
            </StatusBarItem>
            <StatusBarItem>
                <Image Height="12" Width="12" Source="./Data/Icons/object_snap_End.png"/>
            </StatusBarItem>
            <StatusBarItem>
                <CheckBox IsChecked="{Binding ElementName=MainView, Path=SnapToEndPointsOn, Mode=OneWayToSource}">End point</CheckBox>
            </StatusBarItem>
            <StatusBarItem>
                <Image Height="12" Width="12" Source="./Data/Icons/object_snap_Mid.png"/>
            </StatusBarItem>
            <StatusBarItem>
                <CheckBox IsChecked="{Binding ElementName=MainView, Path=SnapToMidPointsOn, Mode=OneWayToSource}">edge Middle</CheckBox>
            </StatusBarItem>
            <StatusBarItem>
                <Image Height="12" Width="12" Source="./Data/Icons/object_snap_Int.png"/>
            </StatusBarItem>
            <StatusBarItem>
                <CheckBox IsChecked="{Binding ElementName=MainView, Path=SnapToIntesectionPointsOn, Mode=OneWayToSource}">Intersection</CheckBox>
            </StatusBarItem>
            
            <!-- CONSOLE VISIBILITY -->
            <Separator/>
            <StatusBarItem>
                <TextBlock Margin="0,0,5,0" FontWeight="Bold" Text="Console:"/>
            </StatusBarItem>
            <StatusBarItem>
                <CheckBox x:Name="chb_ConsoleVis" IsChecked="{Binding ElementName=MainView, Path=ConsoleVisible, Mode=OneWayToSource, FallbackValue=True}">visible</CheckBox>
            </StatusBarItem>
            
            <!-- DEBUG FOR LEADING LINE WHILE DRAWING-->
            <!--<StatusBarItem>
                <TextBlock Text="{Binding LastHitPos, ElementName=lineGenerator, StringFormat=LastHitPos: \{0:0.0\}}" FontWeight="Bold"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="{Binding LLScale, ElementName=lineGenerator, StringFormat=LLScale: \{0:0.0\}}" FontWeight="Bold"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="{Binding LLOffset, ElementName=lineGenerator, StringFormat=LLOffset: \{0:0.0\}}" FontWeight="Bold"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="{Binding LLVisible, ElementName=lineGenerator, StringFormat=LLVisible: \{0\}}" FontWeight="Bold"/>
            </StatusBarItem>-->
            
        </StatusBar>

    </Grid>
</Window>
